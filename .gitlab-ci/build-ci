#!/bin/sh
set -e -u

exec >generated-config-deb.yml
cat "${0%/*}/base-deb.yml"

for cl in */*/debian/changelog
do
	[ -f "$cl" ] || continue
	path="${cl%/debian/changelog}"
	pkg="${path##*/}"
	echo
	echo "lint ${pkg}:"
	echo '  variables:'
	echo "    base: $path"
	echo '  extends: .lint'
	echo '  rules:'
	echo '    - changes:'
	echo "      - ${path}/**/*"
	echo '      - packaging/ucslint/**/*'
done


exec >generated-config-doc.yml
cat "${0%/*}/base-doc.yml"

for make in doc/*/Makefile
do
	[ -f "$make" ] || continue
	path="${make%/Makefile}"
	pkg="${path##*/}"
	echo
	echo "build ${pkg}:"
	echo '  variables:'
	echo "    base: $path"
	echo '  extends: .doc'
	echo '  rules:'
	echo '    - changes:'
	echo "      - ${path}/**/*"
done
