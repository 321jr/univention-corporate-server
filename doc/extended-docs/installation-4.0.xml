<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
          "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [

  <!ENTITY % entities SYSTEM "../stylesheets/macros-en.ent" >

  %entities;
]>
<book lang="en" id="installation-4.0">
<bookinfo>
  <title>Univention Corporate Server</title>
  <subtitle>Extended installation documentation</subtitle>
  <revhistory>
     <revision>
        <revnumber>4.0-0</revnumber>
        <date>16 Oct 2014</date>
     </revision>
  </revhistory>
</bookinfo>

<chapter id="appliance:use">
  <title>Verwendung einer UCS Appliance </title>

  <para> 
	Neben der traditionellen Installation besteht auch die Möglichkeit UCS über ein
	Appliance-Image bereitzustellen. Diese Appliance-Images können sowohl zur einfachen
	Inbetriebnahme in einer Virtualisierungslösung wie VMware verwendet werden, wie auch zur
	Provisionierung einer Cloud-Instanz verwendet werden.
  </para>

  <para> 
	Appliances können mit geringem Aufwand selbst erstellt werden. Dies ist in  <xref
	linkend="appliance:create"/> beschrieben.
  </para>

  <para> 
	Während ein Teil der Einstellungen global im Image vorkonfiguriert werden kann, besteht immer
	noch die Notwendigkeit einer finalen Anpassung der Konfiguration durch den Endkunden, z.B. zur
	Festlegung des Rechnernamens oder der eingesetzten Domäne. Für das Appliance-Image wird daher
	ein Grundsystem installiert und eine Komponente eingerichtet, die dem Enduser die Finalisierung
	der Konfiguration ermöglicht. Alternativ kann die Konfiguration auch automatisiert ohne
	Nutzerinteraktion erfolgen. Dies wird in Kapitel <xref linkend="appliance:use:auto"/>
	beschrieben.
  </para>

  <para> 
	Die interaktive Konfiguration kann auf zwei Wegen erfolgen:

	<itemizedlist>
	  <listitem><simpara>
		Auf dem System startet eine grafische Oberfläche, in der der Webbrowser Firefox im
		Vollbild-Modus gestartet wird, der dann automatisch auf die Konfigurations-URL
		zugreift. Diese Option ist besonders für Images in Virtualisierungslösungen geeignet.
	  </simpara></listitem>

	  <listitem><simpara>
		Die Konfiguration kann auch direkt durch einen externen Webbrowser durchgeführt
		werden. In diesem Fall muss dem Benutzer die IP-Adresse des System bekannt sein (z.B. wenn
		ihm diese im Rahmen der Provisionierung eines Cloud-Images genannt wurde).
	  </simpara></listitem>
	  
	</itemizedlist>
  </para>

  <para> 
	Im Rahmen der initialen Konfiguration kann der Benutzer in der Grundeinstellung die folgenden
	Einstellungen vornehmen:

	<itemizedlist>
	  <listitem><simpara>
		Auswahl der Sprache, Zeitzone und Tastaturlayout
	  </simpara></listitem>

	  <listitem><simpara>
		Konfiguration der Netzwerkeinstellungen
	  </simpara></listitem>
	  
	  <listitem><simpara>
		Einrichtung einer neuen UCS-Domäne oder Beitritt zu einer UCS- oder AD-Domäne
	  </simpara></listitem>
	  
	  <listitem><simpara>
		Software-Konfiguration von UCS-Kernkomponenten. Software von Drittherstellern kann vom
		Benutzer später aus dem Univention App Center installiert werden.
	  </simpara></listitem>
	</itemizedlist>
  </para>

</chapter>



<chapter id="appliance:create">
  <title>Erstellung einer UCS Appliance / Cloud Image</title>

  <section id="appliance:intro">
	<title>Einleitung</title>

	<para> 
	  Dieser Artikel beschreibt die Einrichtung einer Appliance auf Basis von UCS 4.0. Eine solche
	  Appliance kann z.B. verwendet werden um als Cloud Servicer Provider vorkonfigurierte Instanzen
	  zur Verfügung zu stellen. Eine andere Einsatzmöglichkeit ist die Erstellung von Images für
	  typische Virtualisierungslösungen.
	</para>

  </section>

  <section id="appliance:installbase">
	<title>Durchführung der Basis-Installation</title>

	<para> 
	  Das Basis-Image wird über den Standard-UCS-Installer durchgeführt. Weiterführende
	  Informationen zu einzelnen Optionen finden sich im UCS-Handbuch. Die Installation sollte in
	  einer Virtualisierungslösung erfolgen. In diesem Beispiel erfolgt die Installation in
	  UVMM. Als Festplatte der virtuellen Maschine sollte ein QCOW2-Image ausgewählt
	  werden. QCOW2-Images können durch ein Tool (TODOREF) in weitere Virtualisierungsformate wie
	  VirtualBox oder VMWare konvertiert werden.
	</para>

	<para> 
	  Die folgenden Einstellungen werden für das Basis-Image konfiguriert:

	  <itemizedlist>
		<listitem><simpara>
		  Die Installationssprache kann beliebig ausgewählt werden. Anhand der ausgewählten Sprache
		  wird die Locale des Systems festgelegt. Soll die Appliance mehrsprachig einsetzbar sein,
		  kann in einem späteren Schritt eine weitere Locale hinzugefügt werden.
		</simpara></listitem>

		<listitem><simpara>
		  Für die Zeitzone kann eine Vorauswahl getroffen werden, diese kann von den Benutzern der
		  Appliance im Nachhinein angepasst werden.
		</simpara></listitem>

		<listitem><simpara>
		  Das Tastaturlayout ist nur für lokale Anmeldungen relevant, bei einer web-basierten
		  Konfiguration ist sie nicht weiter wichtig.
		</simpara></listitem>

		<listitem><simpara>
		  Für Appliance-Images ist eine Konfiguration über DHCP die sinnvollste
		  Voreinstellung. Der Univention Installer versucht im Rahmen der Netzwerkkonfiguration eine
		  DHCP-Anfrage durchzuführen. Nur wenn diese erfolgreich ist, erfolgt die
		  Netzwerkkonfiguration über DHCP, d.h. es ist notwendig für die Dauer der Einrichtung der
		  Appliance eine IP-Adresse über DHCP zuzuweisen. Dies kann z.B. mit einem <emphasis>IP
		  managed client</emphasis> Objekt in der &ucsUMC; erfolgen.
		</simpara></listitem>

		<listitem><simpara>
		  Im nächsten Schritt wird das initiale Passwort für den root-Benutzer festgelegt. Dieses
		  Root-Passwort wird bei der Inbetriebnahme durch den Enduser angepasst.
		</simpara></listitem>

		<listitem><simpara>
		  Die Partitionierung kann beliebig erfolgen, z.B. durch Einbindung der kompletten
		  Festplatte und Integration in ein LVM, bei der alle Dateien in einer Partition gespeichert
		  werden.
		</simpara></listitem>
	  </itemizedlist>
	</para>

	<para> 
	  Im Anschluß an die Basis-Installation wird ein Dialog angezeigt, in dem ausgewählt werden kann
	  ob eine neue UCS-Domäne erstellt oder einer bestehenden Domäne beigetreten werden soll. Zur
	  Erstellung des Appliance-Modus muss an dieser Stelle abgebrochen werden, in dem CTRL+Q
	  gedrückt wird. Die Installation läuft noch kurze Zeit weiter, währendddessen wird die Meldung
	  <guimenu>Starting Univention System Setup</guimenu> eingeblendet und das System startet
	  anschließend neu. 
	</para>

	<para> 
	  Die Installation des Basis-Images ist nun abgeschlossen. Nach einem Reboot würden dem Benutzer der Appliance
	  die Dialoge zur Anpassung der Konfiguration angezeigt, siehe <xref linkend="appliance:use"/>.
	</para>

	<para> 
	  In vielen Fällen soll die Appliance mit einer bestimmten Software-Auswahl vorkonfiguriert
	  werden. Die Installation erfolgt normalerweise aus dem Univention App Center, das zu diesem
	  Zeitpunkt aber noch nicht verfügbar ist. Die Installation erfolgt daher auf der
	  Kommandozeile. UCS-Standard-Komponenten können über die entsprechenden Paketnamen installiert
	  werden, z.B.

	  <programlisting>
univention-install univention-printserver
	  </programlisting>

	  Pakete aus dem Univention App Center werden mit dem Befehl
	  <command>univention-add-app</command> installiert. Die ID wird im App Center aktuell nicht
	  angezeigt, diese Funktion wird in Kürze implementiert werden, weitere Details finden sich unter
	  <uri>https://forge.univention.org/bugzilla/show_bug.cgi?id=37153</uri>. Die ID einer
	  Applikation kann auch unter feedback@univention.de angefragt werden.

	  <programlisting>
univention-add-app -l APPID
	  </programlisting>
	</para>

	<para> 
	  Das System muss nun sauber heruntergefahren werden, d.h. während keine Dateisysteme gemounted
	  sind. Das kann z.B. erreicht werden, indem das System neu gestartet wird und dann während das
	  System das Grub-Menü anzeigt, in UVMM heruntergefahren wird.
	</para>

	<para> 
	  Nun wird das QCOW-Image (d.h. die Festplatte der virtuellen Maschine) kopiert. Wurde der
	  Storage Pool <emphasis>default</emphasis> verwendet, erfolgt die Speicherung im Verzeichnis
	  <filename>/var/lib/libvirt/images</filename>.
	</para>

	<para> 
	  Soll das Image in Amazon EC2 eingesetzt werden, sind einige weitere Schritte nötig, diese sind in 
	</para>

	<section id="appliance:create:ec2">
	  <title>Bereitstellung eines Images für Amazon EC2</title>
	  <para>
		Für ein Image, dass in Amazon EC2 verwendet werden soll müssen zusätzliche die folgenden
		Anpassungen durchgeführt werden:
	  </para>

	  <para>
		Amazon EC2 verwendet eine PyGrub-Version, die nur Datenformat aus Grub 1 lesen kann
		(menu.lst), während UCS standardmässig Grub 2 als Bootloader verwendet. Die folgende
		&ucsUCR;-Variable führt dazu, dass die Grub-Konfiguration in diesem Format zusätzlich
		generiert wird. Außerdem wird die Bootloader-Konfiguration angepasst:

		<programlisting>
append="$(ucr get grub/append)"
ucr set grub/append="$(echo "$append" | sed -e 's|/dev/sda|/dev/xvda|g;s|splash|nosplash|')"
ucr set grub/root=/dev/xvda1
ucr set grub/grub1root="(hd0)"
update-initramfs -uk all
update-grub
univention-grub-generate-menu-lst
		</programlisting>
	  </para>

	  <para>
		Die initiale Anmeldung auf der EC2-Instanz erfolgt durch einen SSH-Host-Key. Um zu
		verhindern, dass während der Inbetriebnahme der Instanz SSH-Anmeldungen mit dem
		Default-Root-Passwort des Standard-Images erfolgen, wird das initiale Root-Passwort
		entfernt. Die beiden zu setzenden &ucsUCR;-Variablen konfigurieren diesen Startmodus:

		<programlisting>
usermod -p \* root
ucr set server/amazon=true
ucr set apache2/startsite="ucs-overview/initialsetup.html"
		</programlisting>
	  </para>

	  <para>
		Der Nameserver sollte gesetzt werden, in diesem Beispiel auf OpenDNS:
 
		<programlisting>
ucr set nameserver1=208.67.222.222 dns/forwarder1=208.67.222.222
ucr unset nameserver2 nameserver3
ucr unset dns/forwarder2 dns/forwarder3
		</programlisting>
	  </para>
	</section>

	<section id="appliance:create:openstack">
	  <title>Bereitstellung eines Images für OpenStack</title>
	  <para>
		Für OpenStack-Images erfolgt die Provisionierung über Cloud-Init (siehe <xref
		linkend="appliance:use:cloudinit"/>), darüberhinaus sind keine weiteren Anpassungen nötig.
	  </para>
	</section>

	<section id="appliance:create:virt">
	  <title>Bereitstellung eines Images für VMWare / VirtualBox</title>
	  <para>
		Auf Basis des oben erstellten QCOW-Images können auch Virtualisierungs-Images für
		VirtualBox, VMware Player und Vmware ESX(i) erstellt werden. Hierzu stellt Univention ein
		Tool bereit, das über das Paket <package>generate-appliance</package> installiert werden kann
		(die Bereitstellung für UCS 4.0 kann über Bug 37137 verfolgt werden).
	  </para>

	  <para>
		Das Tool <command>generate_appliance</command> muss als Benutzer root gestartet werden, mit
		dem Parameter <emphasis>-s</emphasis> muss das QCOW-Image übergeben werden:
		FIXME: Nicht als root
		

		<programlisting>
generate_appliance -s appliance.qcow2
		</programlisting>

		Standardmässig bekommt die virtuelle Maschine eine CPU und ein Gigabyte RAM zugewiesen. Wenn
		die Appliance einen höheren Speicher- oder CPU-Power-Bedarf hat, kann mit dem Parameter
		<emphasis>-m</emphasis> eine abweichende RAM-Menge in Megabyte und mit
		<emphasis>-c</emphasis> eine andere CPU-Anzahl zugewiesen werden.
		Mit den Parametern <emphasis>--vendor</emphasis> und <emphasis>--product</emphasis> kann ein
		Hersteller- und Produktname spezifiziert werden.
	  </para>

	  <para>
		In der Grundeinstellung werden aus dem QCOW-Image drei verschiedene Virtualisierungs-Images
		erzeugt. Mit der hier jeweils angegebenen Option kann die Erzeugung für einen Typ
		unterbunden werden:

		<itemizedlist>
		  <listitem><simpara>
			Zipped VMware-compatible images (e.g. for VMWare Player), can be suppressed with <emphasis>--no-vmware</emphasis>
		  </simpara></listitem>

		  <listitem><simpara>
			VirtualBox OVA image, can be suppressed with <emphasis>--no-ova-virtualbox</emphasis>
		  </simpara></listitem>

		  <listitem><simpara>
			VMWare ESX(i) OVA image, can be suppressed with <emphasis>--no-ova-esxi</emphasis>
		  </simpara></listitem>
		</itemizedlist>
	  </para>

	</section>




  </section>


  <section id="appliance:use:auto">
	<title>Automatische Konfiguration einer Appliance</title>
	<para>
	  Anstelle einer interaktiven Konfiguration der Appliance durch den Benutzer kann diese auch
	  automatisiert erfolgen. Die automatische Konfiguration kann entweder durch cloud-init (ein
	  allgemeines Tool zur Provisionierung von Cloud-Images) oder durch eine Profildatei des
	  Univention Appliance-Modus erfolgen.
	</para>

	<section id="appliance:use:auto:profile">
	  <title>Automatische Konfiguration mit einer Profildatei des UCS-Appliance-Modus</title>
	  
	  <para>
		Für eine automatische Konfiguration mit dem UCS-Appliance-Modus muss eine Profildatei
		<filename>/var/cache/univention-system-setup/profile</filename> angelegt werden. Hier eine
		Beispielkonfiguration:

		<programlisting>
hostname="ucs"
domainname="testdom.local"
windows/domain="TESTDOM"
ldap/base="dc=testdom,dc=local"
root_password="univention"
 
locale/default="de_DE.UTF-8:UTF-8"
components="univention-s4-connector:univention-samba4 univention-nagios-server"
packages_install="univention-s4-connector univention-samba4 univention-nagios-server"
packages_remove=""

server/role="domaincontroller_master"
 
interfaces/eth0/type=""
interfaces/eth0/address="10.201.101.2"
interfaces/eth0/netmask="255.0.0.0"
interfaces/eth0/network="10.0.0.0"
interfaces/eth0/broadcast="10.255.255.255"
dns/forwarder1="10.201.74.2"
gateway="10.201.0.1"
		</programlisting>

		Wird <emphasis>interfaces/eth0/type</emphasis> auf <emphasis>dynamic</emphasis> gesetzt, wird
		zur Netzwerkkonfiguration DHCP verwendet.
	  </para>

	  <para>
		Anschließend muss das Tool
		<command>/usr/lib/univention-system-setup/scripts/setup-join.sh</command> einmalig aufgerufen
		werden. Anschließend müssen Apache und der UMC-Server neu gestartet werden:

		<programlisting>
		  invoke-rc.d apache2 restart
		  invoke-rc.d univention-management-console-server restart
		</programlisting>
	  </para>
	</section>

	<section id="appliance:use:cloudinit">
	  <title>Automatische Konfiguration einer Appliance mit Cloud-Init</title>
	  <para>
		Cloud-Init ist eine standardisierte Lösung zur Konfiguration eines Images. Cloud-Init prüft
		verschiedene Datenquellen nach einer eventuell vorhandenen Konfiguration. Um ein Image für
		eine Provisionierung durch Cloud-Init vorzubereiten muss das Paket
		<package>cloud-init</package> installiert werden:

		<programlisting>
univention-install cloud-init
		</programlisting>

		Die Konfigurationsdatei wird durch den jeweiligen Cloud-Dienst bereitgestellt; die Art der
		Bereitstellung unterscheidet sich von Cloud-Lösung zu Cloud-Lösung. Aktuell wird nur die
		Provisionierung eines &ucsMaster; unterstützt.
	  </para>

	  <para>
		Im folgenden findet sich eine Beispieldatei, mit der ein &ucsMaster; provisioniert
		wird. Zusätzlich werden auf dem System zwei Dateien erzeugt; einmal die zu installierende
		UCS-Lizenz und eine Datei mit zu installierenden Apps aus dem Univention App Center. Die
		angegebenen Dateien sind base64-codiert. Mit den Befehlen <command>base64</command> und 
		<command>base64 --decode</command> können Dateien codiert/decodiert werden:

		<programlisting>
ucs_setup:
  hostname: myucsmaster
  domainname: ucs.local
  windowsdomain: UCS
  ldap_base: dc=ucs,dc=local
  rootpassword: univention
  defaultlocale: de_DE.UTF-8:UTF-8
  components:
  packages_install:
  packages_remove:
write_files:
-   encoding: b64
    content:
	ZG46IGNuPWFkbWluLGNuPWxpY2Vuc2UsY249dW5pdmVudGlvbixkYz11Y3MsZGM9bG9jYWwKY246IGFkbWluCm9iamVjdENsYXNzOiB0b3AKb2JqZWN0Q2xhc3M6IHVuaXZlbnRpb25MaWNlbnNlCm9iamVjdENsYXNzOiB1bml2ZW50aW9uT2JqZWN0CnVuaXZlbnRpb25MaWNlbnNlQmFzZUROOiBGcmVlIGZvciBwZXJzb25hbCB1c2UgZWRpdGlvbgp1bml2ZW50aW9uTGljZW5zZUNvcnBvcmF0ZUNsaWVudHM6IHVubGltaXRlZAp1bml2ZW50aW9uTGljZW5zZUVuZERhdGU6IHVubGltaXRlZAp1bml2ZW50aW9uTGljZW5zZUtleUlEOiA0MDBkM2IzMS02YWMxLTQwNTgtOTc2Ny1jNTY5Zjk4Mzc1YmEKdW5pdmVudGlvbkxpY2Vuc2VNYW5hZ2VkQ2xpZW50czogNQp1bml2ZW50aW9uTGljZW5zZU1vZHVsZTogYWRtaW4KdW5pdmVudGlvbkxpY2Vuc2VQcmVtaXVtU3VwcG9ydDogMAp1bml2ZW50aW9uTGljZW5zZVNlcnZlcnM6IHVubGltaXRlZAp1bml2ZW50aW9uTGljZW5zZVNpZ25hdHVyZTogWllwVmVLWkhXSkVIVFdMTEhYZTB0ZS9NZTh6cis5SnpCMUYvNFV5RkxPc3JQa3hLCiArS0I3Q0tFbmpGVFg3NnBRN1BMYmhHWHR4VEJDOUlXdzV1T0EzTzdUNEd1ZzU3c1ROTVRnR0FMTzF0Vldxa1cxaFQ5OE9NSW5yUFcKIHlIZmVsVmZGa2hjNEJxQVhCOTlSc1MxY1h0Rm1tWE0xQWF1ekNkOUFqVEFQZm9NSFBmTE9HL1JRVXdGSVU2SjZWaUlMd2p0dGZ1YQogZnZKOWpLNGR1REliTXNSRWxSejNZQkk3M1FwSy9CcG04WXZTd0ZvVGF0RW9kSmJ0RzRIUTNkL2kxV2dPd20wVUdaK3BtNWl1Vm45CiBTN0RnOXorTXdVZ05TUmk2dmdud2F2cVl0NHVtMGhTTHZJOUsvaWVia3BoRW52RVlOb2NFN0xSKy9MSjBBT21XMm5CeXc9PQp1bml2ZW50aW9uTGljZW5zZVN1cHBvcnQ6IDAKdW5pdmVudGlvbkxpY2Vuc2VUeXBlOiBVQ1MKdW5pdmVudGlvbkxpY2Vuc2VVc2VyczogNQp1bml2ZW50aW9uTGljZW5zZVZlcnNpb246IDIKdW5pdmVudGlvbkxpY2Vuc2VWaXJ0dWFsRGVza3RvcENsaWVudHM6IHVubGltaXRlZAp1bml2ZW50aW9uTGljZW5zZVZpcnR1YWxEZXNrdG9wVXNlcnM6IHVubGltaXRlZAp1bml2ZW50aW9uT2JqZWN0VHlwZTogc2V0dGluZ3MvbGljZW5zZQoK
    owner: root:root
    path: /var/cache/univention-system-setup/license
    permissions: '0400'
-   encoding: b64
    content: YWRjb25uZWN0b3IKc2ltcGxlc2FtbHBocAo=
    owner: root:root
    path: /var/cache/univention-system-setup/installapps
    permissions: '0400'
		</programlisting>
	  </para>

	  <para>
		Die Datei mit den zu installierenden Apps enthält eine Liste von IDs von Applikationen aus dem Univention App
		Center.  Die ID wird im App Center aktuell nicht angezeigt, diese Funktion wird in Kürze
		implementiert werden, weitere Details finden sich unter
		<uri>https://forge.univention.org/bugzilla/show_bug.cgi?id=37153</uri>. Die ID einer
		Applikation kann auch unter feedback@univention.de angefragt werden. Die Liste aus dem
		obigen Beispiel sieht decodiert folgendermassen aus, d.h. auf dem provisionierten Master
		wird der Univention AD Connector und die SAML-Integration installiert:

		<programlisting>
adconnector
simplesamlphp
		</programlisting>
	  </para>
	</section>

	<section id="appliance:license">
	  <title>Lizenz-Management in Cloud-Instanzen</title>
	  <para>
		In der Grundinstallation verfügt eine UCS-Installation über die sogenannte
		Free-for-Personal-Use-Lizenz (bis zu fünf Benutzer). Für den produktiven Einsatz einer
		UCS-Installation muss eine Lizenz von Univention bezogen werden. Bei Standard-Installationen
		wird sie dem Benutzer per E-Mail zugesandt und dann in der &ucsUMC; eingerichtet.
	  </para>

	  <para>
		Für Cloud Service Provider besteht die Möglichkeit UCS-Lizenzen über eine API abzurufen,
		d.h. wenn für einen Kunden eine neue Instanz angelegt werden soll, kann die Lizenz durch
		eine API abgerufen werden und dann direkt in die provisionierte Instanz installiert werden.
	  </para>

	  <para>
		Der Zugriff auf den Lizenz-Server erfordert einen Benutzernamen und ein Passwort. Diese
		können bei Univention unter sales@univention.de angefragt werden. In diesem Dokument wird
		als Beispiel-URL für den Lizenzserver https://license.univention.de/shop/example/ verwendet.
	  </para>

	  <section id="appliance:license:api">
		<title>Schnittstelle für den Abruf von UCS-Lizenzen</title>
		<para>
		  Der Abruf der Lizenzen erfolgt über HTTPS mit dem Univention-Lizenz-Server
		  <uri>license.univention.de</uri>. Der Abruf kann komplett mit <command>wget</command>
		  erfolgen.
		  FIXME: Nur manuell über wget erfolgen
		</para>

		<para>
		  Zuerst muss eine Session zum Lizenzserver aufgebaut werden, hier mit dem Usernamen
		  <emphasis>univention</emphasis> und dem Passwort <emphasis>secret</emphasis> als
		  Beispiel. Innerhalb einer Session können auch mehrere Lizenzen abgefragt werden.

		  <programlisting>
wget --keep-session-cookies --save-cookies cookie.db --load-cookies cookie.db \
 --post-data='username=univention&amp;password=secret' \
 https://license.univention.de/shop/example/
		  </programlisting>
		</para>

		<para>
		  Eine Lizenz kann ebenfalls über wget mit einer POST-Anfrage bestellt werden. Es ist zu
		  beachten, dass Sonderzeichen wie Leerzeichen in HTML-Syntax escapt werden müssen:
		  FIXME: URL-Encoding, see http://en.wikipedia.org/wiki/Percent-encoding for details

		  <programlisting>
wget --keep-session-cookies --save-cookies cookie.db --load-cookies cookie.db \
--post-data='kundeEmail=customer@example&amp;'\
'kundeUnternehmen=New%20Customern&amp;'\
'EndDate=27.11.2015&amp;'\
'BaseDN=dc%3Ddrei%2Cdc%3Dzwei%2Cdc%3Dtest&amp;'\
'Servers=0&amp;'\
'Support=0&amp;'\
'PremiumSupport=0&amp;'\
'Users=100&amp;'\
'ManagedClients=0&amp;'\
'CorporateClients=0&amp;'\
'VirtualDesktopUsers=0&amp;'\
'VirtualDesktopClients=0&amp;'\
'Type=UCS' \
https://license.univention.de/shop/example/order
		  </programlisting>
		</para>

		<para>
		  Im Fall eine erfolgreichen Bestellung wird der Return Code 202 zurückgeliefert. In den
		  erhaltenen HTML-Daten findet sich der Tag orderid, der die Bestellnummer einer
		  erfolgreichen Bestellung nennt:

		  <programlisting>-.
... <span id="orderid">21</span> ...
		  </programlisting>
		</para>

		<para>
		  Schlug die Bestellung fehlt, wird ein Return Code 4xx zurückgeliefert, im Tag
		  <emphasis>details</emphasis> finden sich weitere Informationen, z.B:

		  <programlisting>-.
... <span id="details">Not a valid date: u'27.11.201'</span> ...
		  </programlisting>
		</para>

		<para>
		  Kann die Bestellung durch einen Serverfehler nicht verarbeitet werden, wird 5xx als Return
		  Code ausgegeben. Die Bestellung kann dann zu einem späteren Zeitpunkt wiederholt werden.
		</para>

		<para>
		  Nach der Bestellung einer Lizenz dauert es einige Sekunden, bis die Lizenz erstellt
		  wurde. Der unten angebene Aufruf wartet bis zu sechzig Sekunden auf die Verfügbarkeit der
		  Lizenz. Abschließend kann sie mit anhand der Bestellnummer im LDIF-Format abgerufen
		  werden. Lieferte der obige Aufruf die Bestellnummer 465 zurück, lautet der Dateiname
		  465.ldif:

		  <programlisting>
wget --keep-session-cookies --save-cookies cookie.db --load-cookies cookie.db \
https://license.univention.de/shop/example/orders/465.ldif 
		  </programlisting>

		  Liefert der Lizenzabruf den Return Code 4xx ist die Bestellnummer ungültig, bei 5xx konnte
		  die Bestellung noch nicht erfolgreich bearbeitet werden.
		</para>

	  </section>
	</section>


  </section>



</chapter>

	<bibliography>
		<bibliomixed id="ucs-handbuch"/>
		<bibliomixed id="locales"/>
	</bibliography>

<?dbhtml-include href="../stylesheets/piwik.html"?>
</book>
