%autobuild=true changelog

\input{handbuch_pdf_1}

\newcommand{\ucsManualTitle}{UCS 3.1 Release Notes}
\newcommand{\ucsManualSubtitle}{Release Notes für die Inbetriebnahme und
Aktualisierung von Univention Corporate Server (UCS) 3.1}
\newcommand{\ucsManualVersion}{3.1}
\newcommand{\ucsTechAuthor}{ & Univention GmbH & feedback@univention.de}

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

\input{handbuch_pdf_2}

\chapter{Release-Highlights}

Mit Univention Corporate Server 3.1 steht das erste Minor Update für
Univention Corporate Server (UCS) 3.0 zur Verfügung. Es umfasst eine Reihe
umfangreicher Funktionserweiterungen und -verbesserungen, neue
Eigenschaften sowie diverse Detailverbesserungen und Fehlerkorrekturen.

Die wichtigen Neuerungen im folgenden:

\begin{itemize}
\item Univention App Center erlaubt die einfache Einbindung von
Softwarekomponenten in eine UCS-Installation. Die Applikationen werden
sowohl von Drittanbietern wie auch von Univention selbst
(z.B. UCS@school) bereit gestellt. Der Kauf von Lizenzen, Maintenance
oder Support für die Applikation verläuft über den jeweiligen
Hersteller und nicht über das App Center.

\item Das neue Werkzeug Univention AD Takeover erlaubt die einfache
Migration eines Microsoft Active Directory-Verzeichnisses auf eine
UCS-Installation mit Samba 4. Dabei werden alle Benutzer,
Gruppen und Rechnerkonten nebst ihrer Passwörter und
Gruppenrichtlinien übernommen. Ein erneuter Domänenbeitritt der
Windows-Clients ist nicht notwendig.

\item Microsoft Windows 8 und Microsoft Windows Server 2012 werden
jetzt unterstützt. Die dafür eingesetzten Samba-Versionen wurden
aktualisiert (Samba 4 auf 4.0rc6 und Samba 3 auf 3.6.8)

\item Der Linux-Kernel wurde auf Version 3.2.30 aktualisiert und
unterstützt dadurch deutlich mehr und aktuellere Hardware.

\item Der Univention Installer unterstützt nun auch Systeme mit dem
UEFI-Bootstandard. Außerdem wird die Installation nun standardmässig
im GUID Partition Table Standard vorgenommen, was eine effizientere
Partitionierung erlaubt.

\item Die Netzwerkkonfiguration für Bridges, VLANs und Bonding ist nun
mittels Univention Configuration Registry einfacher abbildbar.

\item Zahlreiche Performanceverbesserungen für Umgebungen mit mehreren
Zehntausend Benutzern wurden vorgenommen, z.B. für die
Gruppenauflösung.

\item Zahlreiche Detailverbesserungen bei der Usability im
Managementsystem wurden vorgenommen, z.B. können häufig verwendete
UMC-Module nun in einem Favoritenbereich hervorgehoben angezeigt
werden. Außerdem wurde das Dojo-Framework auf Version 1.8
aktualisiert.

\item Die Dokumentation steht nun
unter \ucsURL{http://docs.univention.de} auch als Online-Variante im
HTML-Format bereit.

\item Der UCS-Virtualisierungs-Stack wurde aktualisiert; Xen liegt nun
in Version 4.1.3 vor, QEMU/KVM in Version 1.1.2 und libvirt in Version
0.9.12.

\end{itemize}

\chapter{Empfohlene Update-Reihenfolge für Umgebungen mit mehr als einem UCS-Server / Update von Systemen mit UCS-Komponenten}

In Umgebungen mit mehr als einem UCS-System muss die Update-Reihenfolge der
UCS-Systeme beachtet werden:

Auf dem \ucsMaster{} wird die maßgebliche (authoritative) Version des
LDAP-Verzeichnis"=dienstes vorgehalten, die an alle übrigen LDAP-Server
der UCS-Domäne repliziert wird. Da bei Release-Updates Veränderungen
an den LDAP-Schemata auftreten können (siehe
Kapitel 3.4.1 des Handbuchs \cite{UCS-Handbuch}) muss der \ucsMaster{} bei einem
Release-Update immer als erstes System aktualisiert werden.

Generell ist es empfehlenswert alle UCS-Systeme möglichst in einem
Wartungsfenster zu aktualisieren.

\section{Hinweise zu Umgebungen mit anderer Dritt-Software}

Bei der Verwendung von 3rd-Party-Software ist generell \emph{vor} dem Update
mit dem Hersteller/Vertriebspartner der Software zu klären, ob
diese mit der neuen Version von Univention Corporate Server weiterhin
uneingeschränkt einsetzbar ist. 

Die Hersteller/Vertriebspartner von auf Univention Corporate Server
basierenden Produkten sorgen eigenständig für die Veröffentlichung. Updates
müssen daher von dort bezogen werden.

Falls Ihnen von Univention angepasste Paketversionen bereitgestellt wurden, so
sollte geprüft werden, ob durch die Aktualisierung angepasste Pakete
überschrieben werden --- vorzugsweise in einer Testumgebung. Sollten Sie hier
Probleme feststellen, so wenden Sie sich bitte an Univention.

\chapter{Vorbereitung des Updates}
Es sollte geprüft werden, ob ausreichend Festplattenplatz verfügbar ist. Eine
Standard-Installation benötigt min. 6 GB Speicherplatz. Das
Update benötigt je nach Umfang der vorhanden Installation mindestens 1 GB
weiteren Speicherplatz zum Herunterladen und Installieren der Pakete.

Für das Update sollte eine Anmeldung auf der Console mit dem
Benutzer \emph{root} durchgeführt und das Update dort gestartet werden.
Alternativ kann das Update über die \ucsUMC{} durchgeführt werden.

Eine Remote-Aktualisierung über SSH wird nicht empfohlen, da dies
beispielsweise bei Unterbrechung der Netzverbindung zum Abbruch des
Update-Vorgangs und zu einer Beeinträchtigung des Systems führen kann. Sollte
dennoch eine Aktualisierung über eine Netzverbindung durchgeführt werden, ist
sicherzustellen, dass das Update bei Unterbrechung der Netzverbindung trotzdem
weiterläuft. Hierfür können beispielsweise die Tools \ucsCommand{screen} oder
\ucsCommand{at} eingesetzt werden, die auf allen Systemrollen installiert sind.




\chapter{Nachbereitung des Updates}

Nach dem Update sollte auf allen Systemen der
Befehl \ucsCommand{univention-run-join-scripts} als
Benutzer \emph{root} aufgerufen und das UCS-System neu gestartet werden.

\section{Migration auf Grub 2}

Bei einer Neuinstallation ab UCS 3.0 wird vom Univention Installer direkt GRUB 2 in den
Bootsektor geschrieben.

Bei einem Update bleibt GRUB 1 im Master Boot Record (MBR) installiert. GRUB 2
richtet einen Eintrag ``Chainload into Grub'' ein, der dann das eigentliche
GRUB 2 lädt.

Eine Dokumentation, um auch auf aktualisierten Systemen Grub 2 direkt
in den MBR zu schreiben wird später bereitgestellt (\ucsBug{23544}).

\section{Migration von PostgreSQL 8.3 auf PostgreSQL 8.4}
Ab UCS 3.0 wird neben PostgreSQL 8.3 auch PostgreSQL 8.4
angeboten. Bei Aktualisierungen von Systemen mit PostgreSQL 8.3 auf
UCS 3.0 wird aber die installierte PostgreSQL Version beibehalten.

Das Update auf PostgreSQL 8.4 ist im
SDB-Artikel \ucsURL{http://sdb.univention.de/1220} beschrieben.

\section{Anpassung der Passwort-Richtlinien beim Einsatz von Samba 4}
Ab UCS 3.1 werden die Einstellungen des Samba-Domänenobjekts (zu
finden im Modul \ucsMenuEntry{LDAP-Verzeichnis} der \ucsUMC{} im Container \emph{samba}) mit den
Samba-Passworteinstellungen synchronisiert. Nach dem Update auf UCS
3.1 greifen dann die strikteren Einstellungen aus Samba 4.

Die Einstellungen sollten nach dem Update geprüft und ggf. angepasst
werden. Hinweise zur Konfiguration finden sich im Kapitel 5.3 des UCS
3.1-Handbuchs (Passwort-Einstellungen für Windows-Clients bei
Verwendung von Samba 4).

Insbesondere wenn bisher kein maximales Passwortalter am Samba-Domänenobjekt gesetzt war,
sollte nach dem Update das maximale Passwortalter in Samba 4 durch
Ausführung des folgenden Kommandos ebenfalls auf den speziellen Wert 0
gesetzt werden:
\begin{ucsConsoleInput}
samba-tool domain passwordsettings set --max-pwd-age 0
\end{ucsConsoleInput}

\section{Anpassung der Dateisystem-Zugriffsrechte für Gruppenrichtlinienobjekte in der Sysvol-Freigabe}
Die in UCS 3.1 eingesetzte Version von Samba 4 verwendet ein
überarbeitetes VFS-Modul zur Speicherung von Dateizugriffsrechten
(NTACLs und fACLs). Nach dem Update sollte der folgende Befehl
einmalig auf allen UCS 3.1 Domänencontrollern mit Samba 4 aufgerufen
werden:
\begin{ucsConsoleInput}
samba-tool ntacl sysvolreset
\end{ucsConsoleInput}
Wegen der Sysvol-Replikation sollte das Kommando als erstes auf dem System aufgerufen werden, das den
Univention S4 Connector bereitstellt, d.h. in den meisten Fällen
zuerst auf dem \ucsMaster{}.

\section{Umstellung des Univention Net Installers für Installationen auf Basis von UCS 3.1}
Der Univention Net Installer bezieht seine Pakete aus einem lokalen
Repository. Wurde ein lokales Repository mit UCS 3.0 aufgesetzt und
der Univention Net Installer eingerichtet, muss nach dem Update 
die UCS-DVD heruntergeladen und der folgende Befehl aufgerufen werden,
um Systeme mit UCS 3.1 installieren zu können:
\begin{ucsConsoleInput}
univention-repository-create -i UCSISOIMAGEDATEI
\end{ucsConsoleInput}

\chapter{Hinweise zum Einsatz einzelner Pakete}

\section{Bootprobleme bei Verwendung der UEFI-Installations-DVD}
Ab UCS 3.1 steht für amd64 neben der Standard-Installations-DVD auch
ein Medium mit Unterstützung für den Unified Extensible Firmware
Interface-Standard (UEFI) bereit.

Auf Systemen, die nur einen UEFI-Start unterstützen, kann sie anstelle
der Standard-DVD verwendet werden.

\section{Umfang des Sicherheits-Supports von Webkit, Konqueror und QtWebKit}
Webkit, Konqueror und QtWebkit werden in UCS im maintained-Zweig des
Repositorys mitgeliefert, aber nicht durch Sicherheits-Updates
unterstützt. Webkit wird vor allem für die Darstellung von
HTML-Hilfeseiten u.ä. verwendet. Als Web-Browser sollte Firefox
eingesetzt werden.

\section{Empfohlene Browser für den Zugriff auf die Univention Management Console}

\ucsUMC{} verwendet für die Darstellung der Web-Oberfläche zahlreiche
Javascript- und CSS-Funktionen. Cookies müssen im Browser zugelassen
sein. Die folgenden Browser werden empfohlen:

\begin{itemize}
\item Chrome ab Version 14
\item Firefox ab Version 10
\item Internet Explorer ab Version 9
\item Safari (auf dem iPad 2)
\end{itemize}

Auf älteren Browsern können Darstellungs- oder Performanceprobleme
auftreten. Die Einrichtung einer aktuellen Firefox-Version unter UCD
3.1 ist im Univention Wiki \cite{ucd-firefox7} dokumentiert.

\section{Aktivierung der Passwortrotation für Samba 4-Domänencontroller}

Die Rotation der Passworte von Samba 4 Domänencontrollern wird beim Update wieder aktiviert.
Dies ist wichtig, weil sich die domänenweite Einstellung für das maximale Passwortalter
unter Samba 4 auch auf Domänencontroller bezieht. Falls die Passswortrotation der
Domänencontroller nicht gewünscht ist, kann sie auf jedem Domänencontroller einzeln
durch Setzen der \ucsUCR{}-Variable \ucsUCRVSA{server/password/change} auf \emph{no} deaktivert werden.

\section{Einschränkungen im Samba 4-Betrieb}

Die aktuell vom Samba-Projekt veröffentlichten Versionen von Samba 4
unterliegen in der Weiterentwicklung noch stärkeren Änderungen als Samba
3. Einige Funktionalitäten stehen daher noch nicht vollständig zur Verfügung:

\begin{itemize}
\item Microsoft Windows Domänencontroller dürfen aktuell nicht in eine Samba 4-Domäne
gejoint werden.
\item Eine selektive Replikation ist mit Samba 4 nicht möglich, da diese durch
Active Directory prinzipiell nicht unterstützt wird (in UCS@school
basiert die selektive Replikation auf der Listener/Notifier-Replikation).
\item Samba 4 unterstützt aktuell keine Forest-Domänen. 
\item Samba 4 unterstützt aktuell keine Vertrauensstellungen.
\end{itemize}

Weitere Hinweise finden sich in Kapitel 8 des UCS-Handbuchs \cite{UCS-Handbuch}.

\section{Deaktivierung der Generierung von LM-Hashes}
In Samba 3 wurden die Passwörter von Benutzern im LM-Hashverfahren gespeichert.
In Umgebungen mit UCS 3.x sind diese Hash-Einträge nicht mehr nötig. 

Ab UCS 3.1 werden keine LM-Hashes mehr generiert. Das alte Verhalten kann durch
Setzen der \ucsUCR{}-Variable \ucsUCRVSA{password/samba/lmhash} auf \emph{true} wieder aktiviert 
werden.

\section{Grafikkarten-Treiberunterstützung}
UCS bringt eine minimale Desktopumgebung mit, die einen Zugriff auf
die UCS-Webschnittstellen oder eine initialen Konfiguration des
Systems ermöglicht. Ab UCS 3.1 wird der Nouveau-Treiber nicht mehr
unterstützt, auf Systemen mit Nvidia-Grafikkarten sollte der
VESA-Treiber verwendet werden.

\section{Installation in VirtualBox}
Bei der Installation von UCS in der Virtualisierungslösung VirtualBox vor Version 4.2 kann folgender Bug auftreten:
Wenn von der Installations-DVD gebotet wird bietet
GRUB die Option \ucsMenuEntry{Boot from first harddisk
partition} an. Wählt man diese Option aus, friert VirtualBox ein.

Als Workaround muß vor dem Neustart der UCS-VM entweder die
Installations-DVD aus den Laufwerkseinstellungen der VirtualBox-VM
entfernt werden oder beim Start der virtuellen Instanz F12 gedrückt
werden und die Festplatte als Bootpartition ausgewählt werden.

\section{Migration einer Samba 3-Umgebung auf Samba 4}
\label{samba-migration}

Es existieren zwei grundlegende Verfahren zur Migration von Samba 3 auf Samba
4:

\begin{itemize}
\item Aufbau einer parallelen Samba 4-Domäne. Beide Domänen verwenden
unterschiedliche NetBIOS-Namen und SIDs. Die Clients treten dann schrittweise
der Samba 4-Domäne bei.
\item Migration aller Systeme innerhalb eines Wartungsfensters.
\end{itemize}

Beide Verfahren sind im Univention Wiki ausführlich dokumentiert:
\ucsURL{http://wiki.univention.de/index.php?title=Migration_from_Samba_3_to_Samba_4}.

\section{Xen} % Bug #29296
Wenn der Xen Hypervisor benutzt wird und das Speicherlimit über die \ucsUCR{}-Variable \ucsUCRVSA{grub/xenhopt} begrenzt wurde, sollte der Wert aktualisiert und um die \texttt{,max:}-Angabe erweitert werden.
Weitere Details in der \href{http://wiki.univention.de/index.php?title=UVMM_Quickstart-3.1#Konfiguration_der_Dom0}{UVMM Quickstart Anleitung}.

\chapter{Changelog}

Die Changelogs mit den detaillierten Änderungsinformationen werden ab UCS 3.0
nur noch in Englisch gepflegt. Aufgeführt sind die Änderung seit UCS 3.0-2.

\input{../changelog/changelog-3.1}

\input{bibtex}

\end{document}
