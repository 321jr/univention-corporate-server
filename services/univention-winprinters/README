univention-winprinters
======================

Dieses Dokument beschreibt das kopieren von installierten Windows-Druckern
von Windows-Systemen zu UCS mit Hilfe des Paketes univention-winprinters.

Erstellungsdatum dieses Dokuments:
14. Juni 2004
Geändert am
13. September 2004

Windows-Client-Systeme benötigen zum Drucken spezielle Treiber und Einstellungen.
Dies gilt auch für Netzwerkdrucker. Ein Windows-Server sendet den Windows-Client
bei Bedarf die Treiber und Einstellungen über das SMB-Protokoll.
Dieses macht UCS auch, wenn UCS einen Windows-Drucker-Server ersetzt
und die Windows-Client-Systeme nicht verändert werden sollen.

UCS-Packete (Debian-Pakete):
univention-winprinters

Versionen:
Diese Installation und die Tests wurden mit UCS 1.2-2-pre(x) unter vmware durchgeführt.

Hinweis:
Dies ist nur eine Migrationshilfe, um von bestehenden Windows-Clients
weiterhin zu drucken, ohne das dort die Einstellungen geändert werden müssen.
Das erstellen von Druckern im Univention-Admin ist die bessere Alternative.


1. Installieren von univention-winprinters
------------------------------------------
Installation:
apt-get install univention-winprinters

Konfiguration:
Die Konfiguration ist nicht notwendig.


2. Übersicht der Kommandos
--------------------------
get_winprinters
   Kopiert die Druckertreiber und Einstellungen von fremden Server und
   erzeugt daraus ein oder mehrere Debianpakete, die lokal gespeicht werden.
   Diese werden nicht automatisch installiert.

list_winprinters
  Zeigt eine Liste der lokal verfügbaren Pakete, die die Druckertreiber
  und die Einstellungen von Windows-Druckern enthalten.
  Mit dpkg -i ... oder apt-get install ... werden diese hinzugefügt.

put_winprinters
  Installiert die Druckertreiber und Druckereinstellungen.
  Im Univention-Admin wird der Drucker als SMB-Drucker erzeugt.
  Die Debianpakete müssen vorher installiert sein.


3. Arbeitsbeschreibung zum Kopieren der Drucker
-----------------------------------------------

3.1. Drucker auf den Windowsserver installieren und freigeben
-------------------------------------------------------------
Dieses ist der Ausgangszustand auf den Windows-Server-System.
Zusätzlich sind folgende Punkte zu beachten:
# - Die Druckernamen dürfen kein Leerzeichen enthalten
#   (Drucker mit Leerzeichen in Namen werden ignoriert).
#   --> Diese Beschränkung ist entfernt worden.

 - Mindestens ein Drucker muss freigegeben sein.
 - Die gewünschten Modi (A4 usw) sollten gewählt sein
   (Nachträglich kann dies nur Client-Seitig erfolgen).
Die Groß- und Kleinschreibweise im Namen kann beliebig verwendet werden.


3.2. Druckerdaten mit Namen, Treibern und Einstellungen lesen
-------------------------------------------------------------
Die Windowsdrucker werden nun von den Windowsservern ausgelesen.
Die Daten werden als Debianpaket abgelegt.
Dieses erledigt das folgenden Kommando:
get_winprinters --nt4_server=<nt-server-name>
		--nt4_username=<nt-administrator-username>
                --nt4_password=<nt-administrator-password>
              [ --nt4_domain=<nt-server-domain> ]
              [ --nt4_ipaddr=<nt-ipaddr> ]

Hierzu ist keine besondere root-Berechtigung notwendig.

Als Ergebnis wird lokal für jeden Drucker ein Debianpacket in der Form
winprt-<druckername>.deb

Bsp. winprt-hp-color-laserjet.deb

Diese Pakete können kopiert, archiviert oder
auch gleich weiter werwendet werden.


3.3. Druckerdaten auf UCS installieren
--------------------------------------
Die gesammelten Druckerdaten im Debianpaket werden mit
apt-get install winprt-<druckername>
oder
dpkg -i winprt-<druckername>.deb
installiert.

Die Pakete sind von Paket univention-winprinters abhängig.

ACHTUNG:
Hierbei wird keine Drucker installiert. Es werden nur die Druckerdaten
in das Verzeichnis /var/lib/winprt-data/ kopiert.


Mit dem Kommando
list_winprinters

kann geprüft werden, welche Druckerpakete dort zur Verfügung stehen.
Dieses erfordert root-Berechtigung.


3.4. Installieren eines Druckers auf UCS
----------------------------------------
Die lokal vorhandenen Druckerdaten können nun verwendet werden,
um die Drucker im UCS zu installieren.
Dies wird mit den folgenden Kommando durchgeführt:
put_winprinters --samba_hostname=<samba-hostname>
                [--ldap_binddn=<ldap-binddn>]
                [--ldap_bindpwf=<ldap-bindpw-file>]
                {printername1 ...}

Beispielsweise kann auch die folgende Anweisung ausgeführt werden,
um alle Drucker zu installieren:
put_winprinters --samba_hostname=localhost `list_winprinters`

Wenn dies Kommando als root auf einen ucs-master ausgeführt wird, ist kein
binddn und bindpw nötig. Sonst sieht das Beispiel so aus:
put_winprinters --samba_hostname=tk-master --ldap_binddn="cn=admin,dc=thomas,dc=univention,dc=de" --ldap_bindpwf=pwd.file `list_winprinters`

4. Test
-------
Installierte Drucker müssen im Univention-Admin als smb-Drucker zu finden sein.
Weiterhin müssen diese in Cups sichtbar sein (http://druckerserver:631).
Aus Cups heraus können Testseiten erzeugt werden.
Dort werden auch Druckermeldungen angezeigt.
In der Windows-Netzumgebung sind die Drucker zu finden und zu verwenden.
Testseiten können auch aus Windows erzeugt werden.
Jeder Ausdruck wird in Cups verbucht. Wenn der Drucker ein Problem hat,
so wird sich dieses Problem in der Cups-Verwaltung finden.


5. Ergebnis
-----------
Aus Windows-Systeme können Drucker erzeugt werden, die von UCS so verarbeitet werden,
als wenn die Druckaufträge von einen Windows-Server verarbeitet werden.

