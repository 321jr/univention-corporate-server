--- opt/scalix-tomcat/bin/sxtomcat-create-instance.scalix 17:57:15.000000000 +0200
+++ opt/scalix-tomcat/bin/sxtomcat-create-instance	2009-09-08 17:49:33.000000000 +0200
@@ -10,7 +10,7 @@
 
 basedir="/opt/scalix-tomcat"
 connectordir="/etc/opt/scalix-tomcat/connector"
-ssl_conf_possible_paths="/etc/httpd/conf.d/ssl.conf /etc/apache2/vhosts.d/vhost.conf"
+ssl_conf_possible_paths="/etc/apache2/mods-enabled/ssl.conf /etc/httpd/conf.d/ssl.conf /etc/apache2/vhosts.d/vhost.conf"
 
 get_ssl_conf_info() {
     f=$1
@@ -99,8 +99,10 @@
     instance="$1"
     tomcathost="$2"
 
-    ssl_has_ok_config
-    should_do_ssl=$?
+## <univention comment="SSL is switched on in mods-available/ssl.conf"/>
+    #ssl_has_ok_config
+    #should_do_ssl=$?
+    should_do_ssl=0
     
     ssl_proto_string=""
     if [ ! -z "$SXTOMCAT_SSLPROTOCOL" ]; then
@@ -108,59 +110,51 @@
     fi
 
     # AJP:
+## <univention comment="The VirtualHost environment supplied by Scalix collides with the default site."/>
     cat >$connectordir/ajp/instance-$instance.conf <<-!!EOF!!
-	<VirtualHost ${tomcathost}:80>
+	#<VirtualHost ${tomcathost}:80>
 	    Include /etc/opt/scalix-tomcat/connector/ajp/app-$instance.*.conf
-	</VirtualHost>
+	#</VirtualHost>
 	!!EOF!!
 
     # AJP SSL
+## <univention comment="The VirtualHost environment supplied by Scalix collides with the default site."/>
     if [ $should_do_ssl -ne 0 ]; then
         cat >>$connectordir/ajp/instance-$instance.conf <<-!!EOF!!
-	<VirtualHost ${tomcathost}:443>
+	#<VirtualHost ${tomcathost}:443>
 	    SSLEngine on
 	    $ssl_proto_string
 	    SSLCipherSuite ${SXTOMCAT_CIPHERSUITE}
 	    SSLCertificateFile ${SXTOMCAT_CERTFILE}
 	    SSLCertificateKeyFile ${SXTOMCAT_KEYFILE}
 	    Include /etc/opt/scalix-tomcat/connector/ajp/app-$instance.*.conf
-	</VirtualHost>
+	#</VirtualHost>
 	!!EOF!!
     fi
 
     # JK:
+## <univention comment="The VirtualHost environment supplied by Scalix collides with the default site."/>
     cat >$connectordir/jk/instance-$instance.conf <<-!!EOF!!
-	<VirtualHost ${tomcathost}:80>
+	#<VirtualHost ${tomcathost}:80>
 	    Include /etc/opt/scalix-tomcat/connector/jk/app-${instance}.*.conf
-	</VirtualHost>
+	#</VirtualHost>
 	!!EOF!!
 
     # JK SSL
+## <univention comment="The VirtualHost environment supplied by Scalix collides with the default site."/>
     if [ $should_do_ssl -ne 0 ]; then
         cat >>$connectordir/jk/instance-$instance.conf <<-!!EOF!!
-	<VirtualHost ${tomcathost}:443>
+	#<VirtualHost ${tomcathost}:443>
 	    SSLEngine on
 	    $ssl_proto_string
 	    SSLCipherSuite ${SXTOMCAT_CIPHERSUITE}
 	    SSLCertificateFile ${SXTOMCAT_CERTFILE}
 	    SSLCertificateKeyFile ${SXTOMCAT_KEYFILE}
 	    Include /etc/opt/scalix-tomcat/connector/jk/app-$instance.*.conf
-	</VirtualHost>
+	#</VirtualHost>
 	!!EOF!!
     fi
 
-    cat >>$connectordir/jk/instance-$instance.conf <<-!!EOF!!
-	JkWorkerProperty worker.${instance}.type=ajp13
-	JkWorkerProperty worker.${instance}.host=${tomcathost}
-	JkWorkerProperty worker.${instance}.port=8009
-	JkWorkerProperty worker.${instance}.lbfactor=50
-	JkWorkerProperty worker.${instance}.cachesize=10
-	JkWorkerProperty worker.${instance}.cache_timeout=600
-	JkWorkerProperty worker.${instance}.socket_keepalive=1
-	JkWorkerProperty worker.${instance}.recycle_timeout=300
-
-	!!EOF!!
-
     workers=""
     if [ -f ${connectordir}/jk/workers.conf ]; then
         workers=`grep 'JkWorkerProperty[ 	]*worker.list=' ${connectordir}/jk/workers.conf | sed -e 's/.*=//'`
@@ -173,7 +167,19 @@
         workers=${instance}
     fi
 
-    echo "JkWorkerProperty worker.list=$workers" >${connectordir}/jk/workers.conf
+    cat >$connectordir/jk/workers.conf <<-!!EOF!!
+	JkWorkerProperty worker.${instance}.type=ajp13
+	JkWorkerProperty worker.${instance}.host=${tomcathost}
+	JkWorkerProperty worker.${instance}.port=8009
+	JkWorkerProperty worker.${instance}.lbfactor=50
+	JkWorkerProperty worker.${instance}.cachesize=10
+	JkWorkerProperty worker.${instance}.cache_timeout=600
+	JkWorkerProperty worker.${instance}.socket_keepalive=1
+	JkWorkerProperty worker.${instance}.recycle_timeout=300
+	JkWorkerProperty worker.list=$workers
+
+	!!EOF!!
+
 }
 
 #
