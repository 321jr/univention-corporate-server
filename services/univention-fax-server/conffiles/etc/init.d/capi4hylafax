#! /bin/sh
#
@%@BCWARNING=#@%@
# Univention FAX Server
#  init-script for capi4hylafax
#
# Copyright (C) 2004, 2005, 2006 Giuseppe Sacco <eppesuig@debian.org>
# Copyright 2009-2010 Univention GmbH
#
# http://www.univention.de/
#
# All rights reserved.
#
# The source code of this program is made available
# under the terms of the GNU Affero General Public License version 3
# (GNU AGPL V3) as published by the Free Software Foundation.
#
# Binary versions of this program provided by Univention to you as
# well as other copyrighted, protected or trademarked materials like
# Logos, graphics, fonts, specific documentations and configurations,
# cryptographic keys etc. are subject to a license agreement between
# you and Univention and not subject to the GNU AGPL V3.
#
# In the case you use this program under the terms of the GNU AGPL V3,
# the program is provided in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public
# License with the Debian GNU/Linux or Univention distribution in file
# /usr/share/common-licenses/AGPL-3; if not, see
# <http://www.gnu.org/licenses/>.

# init-script for capi4hylafax, originally by a debian-capi4hylafax-maintainer
# modifications by Univention GmbH to respect univention-config-registry ha-settings
#
# Start or stop c2faxrecv daemon
#

test -x /usr/bin/c2faxrecv || exit 0

. /lib/lsb/init-functions

run_capi4hylafax=0
if [ -f /etc/default/capi4hylafax ]; then
    . /etc/default/capi4hylafax
fi

if [ $run_capi4hylafax = 0 ]; then
    cat <<EOF

Please edit the file /etc/hylafax/config.faxCAPI according to your needs.
The current /etc/hylafax/config.faxCAPI is just the sample file that is
provided with the upstream package, so it will not be useful at all for
you. (Please read /usr/share/doc/capi4hylafax/README.Debian)

After you are done you will have to edit /etc/default/capi4hylafax as
well. There you will have to set the variable run_capi4hylafax to 1,
and then type "/etc/init.d/capi4hylafax start" to start the c2faxrecv
daemon.

EOF
	exit 0
fi

C2FAXRECVPID=/var/run/c2faxrecv.pid

case "$1" in
	start)
		log_action_msg "Starting capi4hylafax: c2faxrev"
		rm /var/spool/hylafax/FIFO.*
		start-stop-daemon --start --quiet --background --make-pidfile --pidfile $C2FAXRECVPID \
			--exec /usr/bin/c2faxrecv -- -C /etc/hylafax/modem.conf
		log_action_end_msg 0
		;;
	stop)
		log_action_msg "Stopping capi4hylafax: c2faxrev"
		start-stop-daemon --stop --quiet --pidfile $C2FAXRECVPID
		rm -f $C2FAXRECVPID
		log_action_end_msg 0
		;;
	restart | force-reload)
		log_action_msg "Restarting capi4hylafax: c2faxrev"
		start-stop-daemon --stop --quiet --pidfile $C2FAXRECVPID
		sleep 5
		start-stop-daemon --start --quiet --background --make-pidfile --pidfile $C2FAXRECVPID \
			--exec /usr/bin/c2faxrecv -- -C /etc/hylafax/modem.conf
		log_action_end_msg 0
		;;
	*)
		echo "Usage: /etc/init.d/capi4hylafax {start|stop|restart|force-reload}"
		exit 1
esac
exit 0
