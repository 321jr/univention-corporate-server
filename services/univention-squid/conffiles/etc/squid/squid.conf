# Warning: This file is auto-generated and might be overwritten by
#          univention-baseconfig.
#          Please edit the files in the following directory instead:
# Warnung: Diese Datei wurde automatisch generiert und kann durch
#          univention-baseconfig ueberschrieben werden.
#          Bitte bearbeiten Sie an Stelle dessen die Dateien in
#          folgendem Verzeichnis:
#
#       /etc/univention/templates/files/etc/squid/squid.conf
#


hierarchy_stoplist cgi-bin ?
acl QUERY urlpath_regex cgi-bin \?
no_cache deny QUERY
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern .		0	20%	4320
acl all src 0.0.0.0/0.0.0.0
acl manager proto cache_object
acl localhost src 127.0.0.1/255.255.255.255
@!@
for i in range(0,4):
	if baseConfig['interfaces/eth%s/address' % i]:
		print 'acl localnet%s src %s/%s' % (i, baseConfig['interfaces/eth%s/network' % i], baseConfig['interfaces/eth%s/netmask' % i])
	for j in range(0,4):
		if baseConfig['interfaces/eth%s_%s/address' % (i,j) ]:
			print 'acl localnet%s%s src %s/%s' % (i,j, baseConfig['interfaces/eth%s_%s/network' % (i,j)], baseConfig['interfaces/eth%s_%s/netmask' % (i,j)])
@!@
acl to_localhost dst 127.0.0.0/8
@!@
for i in range(0,4):
	if baseConfig['interfaces/eth%s/address' % i]:
		print 'acl to_localnet%s dst %s/%s' % (i, baseConfig['interfaces/eth%s/network' % i], baseConfig['interfaces/eth%s/netmask' % i])
	for j in range(0,4):
		if baseConfig['interfaces/eth%s_%s/address' % (i,j) ]:
			print 'acl to_localnet%s%s dst %s/%s' % (i,j, baseConfig['interfaces/eth%s_%s/network' % (i,j)], baseConfig['interfaces/eth%s_%s/netmask' % (i,j)])
@!@
#acl SSL_ports port 443 563	# https, snews
#acl SSL_ports port 873		# rsync
#acl Safe_ports port 80		# http
#acl Safe_ports port 21		# ftp
#acl Safe_ports port 443 563	# https, snews
#acl Safe_ports port 70		# gopher
#acl Safe_ports port 210		# wais
#acl Safe_ports port 1025-65535	# unregistered ports
#acl Safe_ports port 280		# http-mgmt
#acl Safe_ports port 488		# gss-http
#acl Safe_ports port 591		# filemaker
#acl Safe_ports port 777		# multiling http
#acl Safe_ports port 631		# cups
#acl Safe_ports port 873		# rsync
#acl Safe_ports port 901		# SWAT
acl web_ports port 80 443 21
acl purge method PURGE
acl CONNECT method CONNECT
http_access allow manager localhost
http_access deny manager
http_access allow purge localhost
http_access deny purge
#http_access deny !Safe_ports
#http_access deny CONNECT !SSL_ports
http_access deny !web_ports
@!@
if baseConfig['proxy/ldapauth'] == 'yes':
	print 'auth_param basic program /usr/lib/squid/ldap_auth -h '+baseConfig['ldap/server/name']+' -b "'+baseConfig['ldap/base']+'" -s sub -f "(&(objectClass=organizationalPerson)(uid=%s))"'
	print 'auth_param basic children 5'
	print 'auth_param basic realm Univention proxy server'
	print 'auth_param basic credentialsttl 2 hours'
	print 'external_acl_type ldap_group_inetusers ttl=30 %LOGIN /usr/lib/squid/squid_ldap_group -h '+baseConfig['ldap/server/name']+' -b "cn=groups,'+baseConfig['ldap/base']+'" -f"(&(objectClass=univentionGroup)(cn=%g*)(uniqueMember=%u))" -B "'+baseConfig['ldap/base']+'" -F "(uid=%s)"'
	print 'acl inetusers external ldap_group_inetusers www-access'
	print 'http_access allow inetusers'
else:
	print 'http_access allow localhost'
	for i in range(0,4):
		if baseConfig['interfaces/eth%s/address' % i]:
			print 'http_access allow localnet%s' % i
		for j in range(0,4):
			if baseConfig['interfaces/eth%s_%s/address' % (i,j) ]:
				print 'http_access allow localnet%s%s' % (i,j)
@!@
http_access deny all
http_reply_access allow all
icp_access allow all
coredump_dir /var/spool/squid
@!@
if baseConfig['proxy/force'] == 'yes':
	print 'httpd_accel_host virtual'
	print 'httpd_accel_port 80'
	print 'httpd_accel_with_proxy on'
	print 'httpd_accel_uses_host_header on'
@!@
@!@
if baseConfig['proxy/redirect'] == 'yes':
	print 'redirect_program /usr/bin/squirm'
	print 'redirect_children 10'
elif baseConfig['proxy/redirect'] != 'yes' and baseConfig['proxy/clamav'] == 'yes':
	print 'redirect_program /usr/sbin/squidclamav /etc/squid/squidclamav.conf'
	print 'redirect_children 10'
@!@
forwarded_for off
@!@
if baseConfig['proxy/parent/host']:
	print 'cache_peer '+baseConfig['proxy/parent/host']+' parent '+baseConfig['proxy/parent/port']+' 0 default'
	print 'always_direct allow to_localhost'
	for i in range(0,4):
		if baseConfig['interfaces/eth%s/address' % i]:
			print 'always_direct allow to_localnet%s' % i
		for j in range(0,4):
			if baseConfig['interfaces/eth%s_%s/address' % (i,j) ]:
				print 'always_direct allow to_localnet%s%s' % (i,j)
	print 'never_direct allow all'
@!@
