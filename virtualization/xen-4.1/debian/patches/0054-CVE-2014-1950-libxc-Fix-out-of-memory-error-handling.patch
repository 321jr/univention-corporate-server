From: Andrew Cooper <andrew.cooper3@citrix.com>
Date: Wed, 22 Jan 2014 17:47:21 +0000
Subject: CVE-2014-1950 libxc: Fix out-of-memory error handling in
 xc_cpupool_getinfo()

Avoid freeing info then returning it to the caller.

This is XSA-88.

Coverity-ID: 1056192
Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
Reviewed-by: Jan Beulich <jbeulich@suse.com>
(cherry picked from commit d883c179a74111a6804baf8cb8224235242a88fc)
Commit-4.1: e21b2fa19946806ea27873a8808bc1ace48b7c69
---
 tools/libxc/xc_cpupool.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/tools/libxc/xc_cpupool.c b/tools/libxc/xc_cpupool.c
index 54c76b4..10d8751 100644
--- a/tools/libxc/xc_cpupool.c
+++ b/tools/libxc/xc_cpupool.c
@@ -104,6 +104,7 @@ xc_cpupoolinfo_t *xc_cpupool_getinfo(xc_interface *xch,
     info->cpumap = xc_cpumap_alloc(xch);
     if (!info->cpumap) {
         free(info);
+        info = NULL;
         goto out;
     }
     info->cpupool_id = sysctl.u.cpupool_op.cpupool_id;
