
# HG changeset patch
# User Jan Beulich <jbeulich@suse.com>
# Date 1357748341 -3600
# Node ID 2a91623a5807d8a8a718968d89cb586b32a1dfd3
# Parent  afdcd18ac70f43de3cf486da10327f515806f3ce
VT-d: fix interrupt remapping source validation for devices behind legacy bridges

Using SVT_VERIFY_BUS here doesn't make sense; native Linux also
uses SVT_VERIFY_SID_SQ here instead.

This is XSA-33 / CVE-2012-5634.

Signed-off-by: Jan Beulich <jbeulich@suse.com>
xen-unstable changeset: 26340:19fd1237ff0d
xen-unstable date: Wed Jan  9 16:13:26 UTC 2013

diff -r afdcd18ac70f -r 2a91623a5807 xen/drivers/passthrough/vtd/intremap.c
--- a/xen/drivers/passthrough/vtd/intremap.c	Tue Jan 08 10:23:37 2013 +0100
+++ b/xen/drivers/passthrough/vtd/intremap.c	Wed Jan 09 17:19:01 2013 +0100
@@ -499,7 +499,7 @@ static void set_msi_source_id(struct pci
                 set_ire_sid(ire, SVT_VERIFY_BUS, SQ_ALL_16,
                             (bus << 8) | pdev->bus);
             else if ( pdev_type(bus, devfn) == DEV_TYPE_LEGACY_PCI_BRIDGE )
-                set_ire_sid(ire, SVT_VERIFY_BUS, SQ_ALL_16,
+                set_ire_sid(ire, SVT_VERIFY_SID_SQ, SQ_ALL_16,
                             PCI_BDF2(bus, devfn));
         }
         break;

