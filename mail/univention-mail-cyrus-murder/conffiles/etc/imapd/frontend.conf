# Warning: This file is auto-generated and might be overwritten by
#          univention-baseconfig.
#          Please edit the following file instead:
# Warnung: Diese Datei wurde automatisch generiert und kann durch
#          univention-baseconfig Ã¼berschrieben werden.
#          Bitte bearbeiten Sie an Stelle dessen die folgende Datei:
#
#   /etc/univention/templates/files/etc/imapd/frontend.conf
#


servername: @%@hostname@%@.@%@domainname@%@
configdirectory: /var/lib/mupdate
partition-default: /var/tmp/mupdate
userprefix: user
sharedprefix: shared
virtdomains: userid
postuser: univentioninternalpostuser
robot101mode: yes
altnamespace: no
unixhierarchysep: yes
defaultacl: anyone none
lmtp_downcase_rcpt: yes
admins: cyrus root @!@
mail_cyrus_admins = baseConfig.get('mail/cyrus/admins')
if mail_cyrus_admins:
	print '%s' % mail_cyrus_admins.replace(',',' '),
mail_cyrus_murder_master = baseConfig.get('mail/cyrus/murder/master')
if mail_cyrus_murder_master:
	frontend_emailId = baseConfig.get('mail/cyrus/murder/frontend/id')
	if frontend_emailId:
		print '%s' % frontend_emailId,
	else:
		domainname = baseConfig['domainname']
		myfqdn = '.'.join([ baseConfig['hostname'], domainname ])
		print '%s@%s' % (myfqdn, domainname),
@!@

lmtp_admins: postman cyrus
imap_admins: cyrus root @!@
mail_cyrus_imap_admins = baseConfig.get('mail/cyrus/imap/admins')
if mail_cyrus_imap_admins:
	print '%s' % mail_cyrus_imap_admins.replace(',',' ')
@!@

allowanonymouslogin: no
popminpoll: 0

autocreatequota: 0
@!@
quotawarnpercent = baseConfig.get('mail/cyrus/imap/quotawarnpercent')
if quotawarnpercent:
        print 'quotawarn: %s' % quotawarnpercent
quotawarnkb = baseConfig.get('mail/cyrus/imap/quotawarnkb')
if quotawarnkb:
        print 'quotawarnkb: %s' % quotawarnkb
@!@

umask: 077
sieveusehomedir: false
sievedir: /var/spool/cyrus/sieve
allowplaintext: yes
sasl_mech_list: PLAIN
@!@
mail_cyrus_loginrealms = baseConfig.get('mail/cyrus/loginrealms')
if mail_cyrus_loginrealms:
	print 'loginrealms: %s' % mail_cyrus_loginrealms
hosteddomains = baseConfig.get('mail/hosteddomains')
if hosteddomains:
	print 'loginrealms: %s' % hosteddomains
else:
	print 'loginrealms: %s' % baseConfig['domainname']
@!@

sasl_pwcheck_method: saslauthd
sasl_auxprop_plugin: sasldb
sasl_auto_transition: no

@!@
if baseConfig.get('mail/cyrus/imap/lookup_groups').lower() == 'no':
	print 'unix_group_enable: no'
else:
	print 'unix_group_enable: yes'
@!@

auth_ldap_group: true
ldap_base: @%@ldap/base@%@
ldap_host: @%@ldap/server/name@%@
ldap_port: @%@ldap/port@%@
ldap_to_attr: uid
ldap_from_attr: mailPrimaryAddress

tls_cert_file: /var/lib/mupdate/cert.pem
tls_key_file: /var/lib/mupdate/private.key

tls_ca_path: /etc/univention/ssl/ucsCA/certs/
tls_session_timeout: 1440
tls_cipher_list: TLSv1:SSLv3:SSLv2:!NULL:!EXPORT:!DES:!LOW:@STRENGTH
lmtpsocket: /var/run/cyrus/socket/lmtp
idlesocket: /var/run/cyrus/socket/idle
notifysocket: /var/run/cyrus/socket/notify

@!@
frontend_emailId = baseConfig.get('mail/cyrus/murder/frontend/id')
if not frontend_emailId:
	domainname = baseConfig['domainname']
	myfqdn = '.'.join([ baseConfig['hostname'], domainname ])
	frontend_emailId = '%s@%s' % (myfqdn, domainname)

mail_cyrus_murder_master = baseConfig.get('mail/cyrus/murder/master')
if mail_cyrus_murder_master:
	print '# How to contact the MUPDATE master'
	print 'mupdate_server: %s' % mail_cyrus_murder_master
	print 'mupdate_authname: %s' % frontend_emailId

file = open('/etc/machine.secret','r')
machinepass=file.read().strip()
print 'mupdate_password: %s' % machinepass

print '# How to contact the backend servers'
print 'proxy_authname: %s' % frontend_emailId

backends = baseConfig.get('mail/cyrus/murder/backends')
if backends:
	for backend in backends.split(' '):
		dot = backend.find('.')
		if dot != -1:	# just in case
			backend=backend[:dot]
		print backend + '_password: %s' % machinepass
@!@
