# smtpd_sender_restrictions is not defined since all relevant checks have been moved to
# smtpd_recipient_restrictions (see below) and every mail has to pass smtpd_recipient_restrictions too.
#smtpd_sender_restrictions =

@!@
# get all recipient restrictions from UCR ==> [ (key, val), ... ]
ucrlist = [ x for x in configRegistry.items() if x[0].startswith('mail/postfix/smtpd/restrictions/recipient/') ]

# sender restrictions should really be in smtpd_client_restrictions,
# but they can be in smtpd_recipient_restrictions AFTER reject_unauth_destination
if configRegistry.is_true("mail/postfix/smtpd/restrictions/sender/require_reverse_dns", False):
	ucrlist.append(("mail/postfix/smtpd/restrictions/recipient/60", "reject_unknown_reverse_client_hostname"))
if configRegistry.is_true("mail/postfix/smtpd/restrictions/sender/require_forward-confirmed_reverse_dns", False):
	ucrlist.append(("mail/postfix/smtpd/restrictions/recipient/61", "reject_unknown_client_hostname"))

# add listfilter if enabled by UCR with level "05" (Bug #17954)
if configRegistry.is_true("mail/postfix/policy/listfilter", False):
	ucrlist.append( ('mail/postfix/smtpd/restrictions/recipient/05-listfilter', 'check_policy_service unix:private/listfilter') )
if configRegistry.is_true("mail/postfix/greylisting", False):
	ucrlist.append( ('mail/postfix/smtpd/restrictions/recipient/40-greylisting', 'check_policy_service inet:127.0.0.1:10023') )
ucrlist.sort()
recipient_restrictions = [ x[1] for x in ucrlist ]

print "smtpd_recipient_restrictions = %s" % ",\n        ".join(recipient_restrictions)

# get all recipient restrictions from UCR ==> [ (key, val), ... ]
ucrlist = [x for x in configRegistry.items() if x[0].startswith('mail/postfix/submission/restrictions/recipient/')]
ucrlist.sort()
submission_recipient_restrictions = [x[1] for x in ucrlist]

print '\n# special recipient_restrictions which may be used by smtps/submission services'
print '# (can be configured via UCR: mail/postfix/submission/restrictions/recipient/...)'
if submission_recipient_restrictions:
	print "submission_recipient_restrictions = %s" % ",\n        ".join(submission_recipient_restrictions)
else:
	print "# submission_recipient_restrictions ="
@!@

