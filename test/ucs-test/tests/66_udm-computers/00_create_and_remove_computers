#!/usr/share/ucs-test/runner bash 
## desc: "Create and remove computers"
## exposure: dangerous
## packages:
## - univention-directory-manager-tools
## roles:
## - domaincontroller_master
## - domaincontroller_backup

. "$TESTLIBPATH/udm.sh" || exit 137
. "$TESTLIBPATH/random.sh" || exit 137

UDM_computers_name="$(random_chars)"
UDM_computers_ip="2.5.1.2"
UDM_computers_mac="05:01:02:03:04:05"

# We want to test the UDM modules, so we stop the S4 connector to prevent side effects
test -x /etc/init.d/univention-s4-connector && /etc/init.d/univention-s4-connector stop

for role in $UDM_ALL_COMPUTER_ROLES; do
	info "*** Creating: $role ***"

	udm_create "$role" "UDM_computers_" || fail_test 110
	udm_exists "$role" "UDM_computers_" || fail_test 110

	udm_remove "$role" "UDM_computers_" || fail_test 110
	! udm_exists "$role" "UDM_computers_" || fail_test 110
done

test -x /etc/init.d/univention-s4-connector && /etc/init.d/univention-s4-connector start

exit "$RETVAL"
