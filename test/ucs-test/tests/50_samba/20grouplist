#!/usr/share/ucs-test/runner bash
## desc: "Display samba Groups as normal user"
## exposure: safe
## packages:
##  - univention-samba
## roles-not: 
## - basesystem
## - memberserver
## tags: [basic]

. "$TESTLIBPATH/user.sh" || exit 137

SAMBA="true"
MAIL="false"
KERBEROS="false"
PERSON="false"
POSIX="true"


username="$(user_randomname)"
password="univention"

##create user
trap 'user_remove "$username"' INT TERM EXIT
echo "----create user"
if ! user_create "$username"; then
	fail_fast 1 "Failed to create user"
fi

##wait for the user to be created
echo "----wait for the user to be created"
i=0
while ! output="$(net rpc user info "$username" -U "$username%$password")"
do
	let i="$i"+1
	sleep 1
	if [ "$i" = 20 ]; then
		echo "$output"
		fail_fast 1 "The User which has been created in UDM could not be found in samba."

	fi
done


## display samba groups
echo "----display samba groups"
output="$(net rpc group -U "$username%$password" | grep "Domain Users")"
if [ "$?" != 0 ];then
	echo "$output"
	fail_fast 1 "The test trying to display samba-Groups as a user failed"
fi


exit $RETVAL
