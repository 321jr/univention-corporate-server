#!/usr/share/ucs-test/runner python
## desc: Check DHCP pool attributes
## tags: [udm-dhcp,apptest]
## roles: [domaincontroller_master]
## exposure: careful
## packages:
##   - univention-config
##   - univention-directory-manager-tools



import univention.testing.utils as utils
import univention.testing.udm as udm_test
import univention.testing.strings as uts

if __name__ == '__main__':
	dhcpPoolProperties = {
		'name': uts.random_string(),
		'range': '10.20.30.40 10.20.30.50',
		'failover_peer': uts.random_string(),
		'known_clients': 'deny',
		'unknown_clients': 'allow',
		'dynamic_bootp_clients': 'deny',
		'all_clients': 'allow'
	}

	with udm_test.UCSTestUDM() as udm:
		dhcpService = udm.create_object('dhcp/service', service = uts.random_name())
		dhcpSubnet = udm.create_object('dhcp/subnet', subnet = '10.20.30.0', subnetmask = '24', superordinate = dhcpService)
		dhcpPool = udm.create_object('dhcp/pool', superordinate = dhcpSubnet, **dhcpPoolProperties)

		if not utils.verify_ldap_object(dhcpPool, {
			'cn': [dhcpPoolProperties['name']],
			'dhcpRange': [dhcpPoolProperties['range']],
			'univentionDhcpFailoverPeer': [dhcpPoolProperties['failover_peer']],
			'dhcpPermitList': ['deny known clients', 'allow unknown clients', 'deny dynamic bootp clients', 'allow all clients']
		}):
			utils.fail()

