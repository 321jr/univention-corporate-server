#!/usr/share/ucs-test/runner python
## desc: Testing the basic functionality to create a printer and rename it
## tags: [udm-printers,apptest]
## roles:
##   - domaincontroller_master
##   - domaincontroller_slave
##   - domaincontroller_backup
##   - memberserver
##   - managedclient
## exposure: careful
## packages:
##   - univention-config
##   - univention-directory-manager-tools


import univention.testing.utils as utils
import univention.testing.udm as udm_test
import univention.testing.strings as uts
import univention.testing.ucr



if __name__ == '__main__':
	ucr = univention.testing.ucr.UCSTestConfigRegistry()
	ucr.load()
	printerProperties = {
		'model': 'foomatic-ppds/Apple/Apple-12_640ps-Postscript.ppd.gz',
		'uri': 'paralell /dev/lp0',
		'spoolHost': '%s.%s' % (ucr['hostname'], ucr['domainname']),
		'name': uts.random_name()
	}
	printerSambaName = uts.random_name()
	expectedLdap = {
		'cn': [printerProperties['name']],
		'univentionPrinterModel': [printerProperties['model']],
		'univentionPrinterURI': [printerProperties['uri'].replace(' ', '')],
		'univentionPrinterSpoolHost': [printerProperties['spoolHost']]
	}

	with udm_test.UCSTestUDM() as udm:
		printer = udm.create_object('shares/printer', position = 'cn=printers,%s' % ucr['ldap/base']
, **printerProperties)
		if not utils.verify_ldap_object(printer, expectedLdap):
			utils.fail()

		udm.modify_object('shares/printer', dn = printer, sambaName = printerSambaName)
		if not utils.verify_ldap_object(printer, {'univentionPrinterSambaName': [printerSambaName]}):
			utils.fail()
