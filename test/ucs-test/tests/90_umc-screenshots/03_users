#!/usr/share/ucs-test/runner python
# desc: UMC login test
# roles-not: [basesystem]
# exposure: dangerous

from lib.screen_shooter import BaseScreenShooter
from univention.admin import localization
translator = localization.translation('univention-ucs-test_umc-screenshots')
_ = translator.translate


class ScreenShooter(BaseScreenShooter):
	def take_screenshots(self, user_template_exists=False):
		self.open_module_and_take_overview_screenshot()
		self.take_screenshots_of_adding_a_user(user_template_exists)
		self.take_screenshot_of_details_page()

	def open_module_and_take_overview_screenshot(self):
		self.selenium.open_module(_('Users'))
		self.selenium.wait_for_text(":/users")
		self.selenium.wait_until_all_standby_animations_disappeared()
		self.selenium.save_screenshot("umc-users")

	def take_screenshots_of_adding_a_user(self, user_template_exists):
		self.selenium.click_button(_("Add"))
		if user_template_exists:
			self.take_template_screenshot_and_move_on()
		self.selenium.wait_for_text(_("First name"))
		self.selenium.enter_input("firstname", "Anna")
		self.selenium.enter_input("lastname", "Alster")
		self.selenium.enter_input("username", "anna")
		self.selenium.save_screenshot("umc-users-add_dialog", xpath='//*[@id="umc_modules_udm_NewObjectDialog_0"]')
		self.selenium.click_button(_("Next"))
		self.selenium.wait_for_text(_("Password *"))
		self.selenium.enter_input("password_1", "univention")
		self.selenium.enter_input("password_2", "univention")
		self.selenium.click_button(_("Create user"))
		self.selenium.wait_for_text(_("has been created"))
		self.selenium.click_button(_("Cancel"))
		self.selenium.wait_until_all_dialogues_closed()

	def take_template_screenshot_and_move_on(self):
		# TODO: Make nicer screenshot.
		self.selenium.wait_for_text(_("User template"))
		self.selenium.save_screenshot("umc-users-template", xpath='//*[@id="umc_modules_udm_NewObjectDialog_0"]')
		self.selenium.click_button(_("Next"))

	def take_screenshot_of_details_page(self):
		self.selenium.click_grid_entry(_("anna"))
		self.selenium.wait_for_text(_("password history"))
		self.selenium.save_screenshot("umc-users-details")

if __name__ == '__main__':
	# TODO: Delete user "anna" if it already exists.
	with ScreenShooter(translator) as screen_shooter:
		screen_shooter.take_screenshots(True)
