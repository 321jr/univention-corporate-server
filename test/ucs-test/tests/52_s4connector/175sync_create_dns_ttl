#!/usr/share/ucs-test/runner python
## desc: Univention-s4-connector dns ttl syncronisation
## exposure: dangerous
## packages:
##   - univention-config
##   - univention-directory-manager-tools
##   - univention-s4-connector
##   - dnsutils
## bugs:
##   - 29211
##   - 23732


import univention.testing.udm as udm_test
import univention.testing.strings as uts
import univention.testing.utils as utils
import random
import dnstests


if __name__ == '__main__':
	with udm_test.UCSTestUDM() as udm:

		random_zone = dnstests.random_zone()
		host = dnstests.get_hostname()
		random_ttl = random.randrange (1,10000)

		forward_zone = udm.create_object('dns/forward_zone', zone = random_zone, nameserver = host, zonettl = random_ttl)

		dnstests.check_ldap_object(forward_zone, 'Forward Zone TTL', 'dNSTTL', '%s'%random_ttl)

		dnstests.wait_for_sync(4)

		dnstests.test_dns_ttl(random_zone, random_ttl)

		dnstests.check_ldap_object(forward_zone, 'Forward Zone TTL', 'dNSTTL', '%s'%random_ttl)

		dnstests.wait_for_sync()
