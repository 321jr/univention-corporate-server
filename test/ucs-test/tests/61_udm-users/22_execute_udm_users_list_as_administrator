#!/usr/share/ucs-test/runner python
## desc: Execute "udm users/user list --filter uid=Administrator" as Administrator
## tags: [udm-users,apptest]
## roles:
##   - domaincontroller_master
##   - domaincontroller_backup
## exposure: secure
## packages:
##   - univention-directory-manager-tools


import sys
import subprocess
import univention.testing.utils as utils

if __name__ == '__main__':
	cmd = ['su', 'Administrator', '-c', '/usr/sbin/univention-directory-manager users/user list --filter uid=Administrator']
	udm = subprocess.Popen(cmd, stdout=subprocess.PIPE)
	
	output = udm.communicate()[0]
	if udm.returncode != 0:
		utils.fail('UDM-CLI returned %i while trying to execute "%s" as Adminstrator. Returncode of "0" was expected' % ( udm.returncode, cmd[3:] ))

	if not 'DN: uid=Administrator' in output:
		utils.fail('Could not find DN of user "Administrator" in UDM-CLI output:\n%s' % output)
