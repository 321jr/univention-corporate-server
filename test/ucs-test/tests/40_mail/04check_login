#!/usr/share/ucs-test/runner python
## desc: Cyrus authentication
## tags: apptest
## exposure: safe
## packages: [cyrus-common]
## bugs: [23527]

import subprocess
import os
import univention.testing.utils as utils

def main():
	env = os.environ.copy()
	env.update({'COLUMNS':'30', 'LINES':'20', 'TERM':'xterm'})
	cmd = ['/usr/bin/cyradm', '--server=localhost', '--password=univention', '--auth=login']
	out, err = subprocess.Popen(cmd, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env).communicate()
	if 'localhost>' not in out or err:
		utils.fail(err)

if __name__ == '__main__':
	main()
