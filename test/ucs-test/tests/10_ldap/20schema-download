#!/usr/share/ucs-test/runner bash
## desc: Checking ldap schema download
## tags: [basic]
## roles:
##  - domaincontroller_master
## packages:
##  - univention-config
##  - univention-directory-manager-tools
## exposure: dangerous

# activate ldap schema download
univention-config-registry set ldap/schema/export=yes
/etc/init.d/slapd restart

# try to download schema file
wget -c $(hostname)/ldap-schema.txt -O /dev/null
ret=$?

# deactivate ldap schema download
univention-config-registry unset ldap/schema/export
/etc/init.d/slapd restart

if [ $ret -eq 0 ]
then
        exit 0
else
        exit 1
fi
