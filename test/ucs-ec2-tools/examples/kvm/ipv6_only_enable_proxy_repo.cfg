[EC2Tags]
usecase: dev-jenkins-ucs4.0

[Global]
# These settings can be overwritten by the instance
logfile: ~/ec2/logfiles/ip6.log

virtualisation: kvm

kvm_user: breiteme
kvm_server: krus.knut.univention.de
kvm_architecture: amd64
kvm_ucsversion: 4.0-3
kvm_template: generic
kvm_interface: eth0

[UCS-master-ipv6-ucs-test]
profile:
 hostname="master-ip6-ucs-test"
 domainname="brtest.local"
 windows/domain="BRTEST1"
 ldap/base="dc=brtest,dc=local"
 ssl/email="ssl@brtest.local"
 timezone="Europe/Berlin"
 locale/default="de_DE.UTF-8:UTF-8"
 root_password="univention"
 server/role="domaincontroller_master"
 packages_install=""
 packages_remove=""
 interfaces/eth0/ipv6/default/address="2001:4dd0:ff00:8c42:ff39::46"
 interfaces/eth0/ipv6/default/prefix="64"
 ipv6/gateway="2001:4dd0:ff00:8c42::1"
 nameserver1="2001:4dd0:ff00:8c42::1"
 interfaces/eth0/acceptra="no"
command1:
 # add ssh key
 mkdir /root/.ssh; chmod 700 /root/.ssh; cat /root/id_rsa.pub >> /root/.ssh/authorized_keys ; rm /root/id_rsa.pub
 . utils.sh; basic_setup
command2:
 . utils.sh; upgrade_to_latest
 . utils.sh; upgrade_to_latest_errata
 ucr set interfaces/restart/auto="no"
 ucr unset interfaces/eth0/address
 ucr unset interfaces/eth0/netmask
 ucr unset interfaces/eth0/network
 ucr unset interfaces/eth0/broadcast
 . utils.sh; run_setup_join 
 ucr set interfaces/restart/auto="yes"
 . utils.sh && do_reboot
 LOCAL sleep 120
 . utils.sh && wait_for_reboot
command3:
 #add the ipv6 proxy (to omar) as a software source.
 echo "deb http://[2001:4dd0:ff00:8c42:ff39::200]/build2/ ucs_4.0-0-errata4.0-3/all/"      >> /etc/apt/sources.list
 echo "deb http://[2001:4dd0:ff00:8c42:ff39::200]/build2/ ucs_4.0-0-errata4.0-3/\$(ARCH)/" >> /etc/apt/sources.list
 #change to public (ipv6) update server
 ucr set update/secure_apt="no"
 ucr set repository/online/server='updates.software-univention.de'
 . utils.sh; install_ucs_test
files:
 ~/ec2/scripts/utils.sh /root/
 ~/ec2/scripts/* /usr/sbin
 ~/.ssh/id_rsa.pub /root/
