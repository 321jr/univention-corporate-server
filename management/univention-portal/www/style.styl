/*
 * Copyright 2017-2020 Univention GmbH
 *
 * https://www.univention.de/
 *
 * All rights reserved.
 *
 * The source code of this program is made available
 * under the terms of the GNU Affero General Public License version 3
 * (GNU AGPL V3) as published by the Free Software Foundation.
 *
 * Binary versions of this program provided by Univention to you as
 * well as other copyrighted, protected or trademarked materials like
 * Logos, graphics, fonts, specific documentations and configurations,
 * cryptographic keys etc. are subject to a license agreement between
 * you and Univention and not subject to the GNU AGPL V3.
 *
 * In the case you use this program under the terms of the GNU AGPL V3,
 * the program is provided in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public
 * License with the Debian GNU/Linux or Univention distribution in file
 * /usr/share/common-licenses/AGPL-3; if not, see
 * <https://www.gnu.org/licenses/>.
 */

// @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,400&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400&display=swap');
@import "bootstrap-reboot.css"
@import "../js/dijit/themes/dijit.css"
@import "menu.styl"


// base.styl
:root
	--color-primary: #7AB51D
	--color-grey0:   #1E1E1D
	--color-grey0-rgb:   30, 30, 29
	--color-grey8:   #333331
	--color-grey8-rgb:   51, 51, 49
	--color-grey25:  #5F5F5C
	--color-grey40:  #868681
	--color-grey62:  #BDBDBB
	--color-white:   #FFF

	--bgc-content-header: var(--color-grey0)
	--bgc-content-body:   var(--color-grey8)

	// fonts
	--font-size-big:    28px
	--font-size-normal: 20px
	--font-size-small:  16px
	--font-size-header1: var(--font-size-big)
	--font-size-header2: var(--font-size-normal)
	// --font-size-header1: 28px
	// --font-size-header2: 20px
	--font-color-contrast-high: var(--color-white)
	--font-color-contrast-middle: var(--color-grey62)
	--font-color-contrast-low: var(--color-grey40)
	--font-lineheight-normal: 1.5
	--font-lineheight-header1: 1.3


	// layout
	--layout-spacing-unit: 8px
	--layout-spacing-unit-small: 4px
	// --layout-margin: calc(4 * var(--layout-spacing-unit))

	// buttons
	--button-icon-hover-bgc: rgba(255, 255, 255, 0.08)
	--button-icon-active-bgc: rgba(255, 255, 255, 0.12)

html
	font-size: var(--font-size-normal)


// icons
// TODO generalize
$iconDiameter = calc(3 * var(--layout-spacing-unit))
$icon
	// width: $iconDiameter
	// height: @width
	background-size: contain

.iconTabs
	@extends $icon
	background-image: url(icons/tabs_white.svg)

	.dijitToggleButtonChecked &
		background-image: url(icons/tabs_checked.svg)
.iconSearch
	@extends $icon
	background-image: url(icons/search_white.svg)

	.dijitToggleButtonChecked &
		background-image: url(icons/search_checked.svg)
.iconBell
	@extends $icon
	background-image: url(icons/bell_white.svg)

	.dijitToggleButtonChecked &
		background-image: url(icons/bell_checked.svg)
.iconMenu
	@extends $icon
	background-image: url(icons/menu_white.svg)

	.dijitToggleButtonChecked &
		background-image: url(icons/menu_checked.svg)
.iconGear
	@extends $icon
	background-image: url(icons/gear_white.svg)

	.dijitToggleButtonChecked &
		background-image: url(icons/gear_checked.svg)

.iconX
	@extends $icon
	background-image: url(icons/x_white.svg)

.iconEdit
	@extends $icon
	background-image: url(icons/edit_white.svg)


//// buttons
.dijitButtonNode
	border: none
	height: calc(5 * var(--layout-spacing-unit))
	display: flex
	align-items: center
	justify-content: center
	transition: background-color 250ms

.ucsTextButton
	--bgc: transparent
	font-size: var(--font-size-normal)
	&.dijit
		&Hover,
		&Focused
			--bgc: var(--button-icon-hover-bgc)
		&Active
			--bgc: var(--button-icon-active-bgc)
	vertical-align: unset
	margin: 0

	.dijitButtonNode
		padding: 0 calc(2 * var(--layout-spacing-unit))
		border-radius: 2px
		background-color: var(--bgc)

	.dijitIcon
		width: @font-size
		height: @width

	.dijitButtonText
		color: var(--font-color-contrast-high)
		font-weight: 600
		text-transform: uppercase
		letter-spacing: 1.25px

	.dijitButtonContents
		outline: 0 // TODO do this generally or case by case?
		display: flex
		align-items: center

.ucsIconButton
	--bgc: transparent
	&.dijit
		&Hover,
		&Focused
			--bgc: var(--button-icon-hover-bgc)
		&Active
			--bgc: var(--button-icon-active-bgc)
	vertical-align: unset // TODO test and then patch out of dijit.css if unnecessary ?
	margin: 0

	.dijitButtonNode
		width: calc(5 * var(--layout-spacing-unit))
		border-radius: 100%
		background-color: var(--bgc)

	.dijitIcon
		height: calc(3 * var(--layout-spacing-unit))
		width: @height
	&--small
		.dijitButtonNode
			height: calc(3 * var(--layout-spacing-unit))
			width: @height

		.dijitIcon
			height: calc(2 * var(--layout-spacing-unit))
			width: @height

	.dijitButtonContents
		outline: 0 // TODO do this generally or case by case?
		display: flex
		align-items: center

//// buttons end


//// textbox
.dijitTextBox
	position: relative
	height: calc(15 * var(--layout-spacing-unit-small))
	width: 100%
	color: var(--font-color-contrast-high)
	font-size: var(--font-size-normal)
	background-color: var(--color-grey8)
	border: 1px solid transparent
	border-radius: 2px // TODO
	transition: background-color, color, border
	transition-duration: 250ms

.dijitTextBox
	display: flex
	flex-direction: row-reverse
	align-items: center

	> *
		flex: 0 0 auto

	.dijitInputContainer
		flex: 1 1 auto
		height: 100%

		.dijitInputInner,
		.umcInlineLabel,
		.dijitPlaceHolder
			height: 100%
			text-overflow: ellipsis
			padding: calc(5 * var(--layout-spacing-unit-small)) !important
			font-size: var(--font-size-normal)
			line-height: var(--font-lineheight-normal)

		.umcInlineLabel,
		.dijitPlaceHolder
			display: flex
			align-items: center
			position: absolute
			top: 0
			left: 0
			height: 100%
			width: 100%
			white-space: nowrap
			overflow: hidden
			pointer-events: none // we want the cursor for the inputfield not these placeholder elements
			color: var(--font-color-contrast-middle)


		.umcInlineLabel
			visibility: hidden
			&.umcEmptyValue
				visibility: visible
//// textbox end


//// fonts
body
	font-family: 'Open Sans', sans-serif
	color: var(--font-color-contrast-high)

.h1
	font-size: var(--font-size-header1)
	line-height: var(--font-lineheight-header1)
	font-weight: 600

h1
	@extends .h1

.h2
	font-size: var(--font-size-header2)
	line-height: var(--font-lineheight-normal)
	font-weight: 600

h2, h3, h4, h5, h6
	@extends .h2
//// fonts end


body
	background-color: var(--bgc-content-body)


.bgc-content-header {
	background-color: var(--bgc-content-header)
}

.bgc-content-body {
	background-color: var(--bgc-content-body)
}




////// portal style (style.styl)
:root
	--portal-header-height: calc(14 * var(--layout-spacing-unit-small))

.portal
	// --portal-header-height: calc(15 * var(--layout-spacing-unit-small))
	--portal-header-to-content-seperator-height: var(--layout-spacing-unit-small)

$box-shadow()
	box-shadow: 0 1px 1px rgba(0,0,0,0.12), 0 2px 2px rgba(0,0,0,0.12), 0 4px 4px rgba(0,0,0,0.12)

$blur()
	filter: blur(8px)

body.scrollLess
	overflow: hidden

@css {
	.overlaybg {
		background: rgba(var(--color-grey8-rgb), 0.8);
		backdrop-filter: blur(8px)
	}
}


//// portal header
.portal__header
	position: fixed
	top: 0
	left: 0
	right: 0
	z-index: 1
	background-color: var(--bgc-content-header)
	color: var(--font-color-contrast-high)
	height: var(--portal-header-height)
	display: flex
	// padding: 0 var(--layout-margin)
	padding: 0 calc(2 * var(--layout-spacing-unit))

.portal__header__left
	flex: 0 0 auto
	display: flex
	align-items: center
	cursor: pointer

	img
		width: calc(6 * var(--layout-spacing-unit-small))
		margin-right: calc(3 * var(--layout-spacing-unit-small))

	h2 // TODO have margin 0 as general style?
		margin: 0

.portal__header__stretch
	flex: 1 1 auto

.portal__header__right
	display: flex
	align-items: center

.portal__header__right .dijitToggleButton
	margin: 0 var(--layout-spacing-unit-small)
//// portal header end


// .portal__body
	// background-color: var(--bgc--content-body)
	// padding: 0 calc(2 * var(--layout-spacing-unit))

.portal__categories
	position: relative
	top: var(--portal-header-height)
	padding: calc(7 * var(--layout-spacing-unit)) calc(4 * var(--layout-spacing-unit))

.portal__category
	margin-bottom: calc(10 * var(--layout-spacing-unit))

	&:last-child
		margin-bottom: 0

$tileWidth = calc(20 * var(--layout-spacing-unit))
.portal__category__tiles
	display: grid
	grid-template-columns: repeat(auto-fill, $tileWidth)
	grid-gap: calc(7 * var(--layout-spacing-unit))


.portal__category__title
	margin-bottom: calc(6 * var(--layout-spacing-unit))


.tileLink,
.tileLink:hover
	color: var(--font-color-contrast-high)
	text-decoration: none
// TODO do this generally or case by case?
.tileLink
	outline: 0 

.tile
	width: $tileWidth
	display: flex
	flex-direction: column
	align-items: center
	cursor: pointer

$tile__box
	border-radius: 15%
	display: flex
	align-items: center
	justify-content: center
	$box-shadow()

.tile__box,
.tile__box--thumbnail,
.tile__box--thumbnail--folder
	@extends $tile__box

.tile__box
	width: calc(20 * var(--layout-spacing-unit))
	height: @width
	margin-bottom: calc(2 * var(--layout-spacing-unit))

.tile__logo
	width: 80%

.tile__name
	text-align: center
	width: 100%
	overflow: hidden
	text-overflow: ellipsis
	white-space: nowrap // TODO not sure

.tile__thumbnails
	width: 80%
	height: @width
	display: grid
	grid-template-columns: repeat(3, 1fr)
	grid-template-rows: repeat(3, 1fr)
	grid-gap: 8px

.tile__box--thumbnail--folder
	background: var(--color-grey62)

@css {
	.tile__box--folder {
		background: rgba(var(--color-grey0-rgb), 0.7);
	}
}

$appDescriptionPadding = calc(2 * var(--layout-spacing-unit))
.appDescription
	font-size: var(--font-size-small)
	position: fixed
	bottom: $appDescriptionPadding
	right: @bottom
	background-color: var(--color-grey0)
	border-radius: 16px
	max-width: calc(40 * var(--layout-spacing-unit))
	padding: $appDescriptionPadding
	$box-shadow()

.appDescription__header
	display: flex
	align-items: center
	margin-bottom: $appDescriptionPadding

	.tile__box--thumbnail
		width: calc(3 * var(--layout-spacing-unit))
		height: @width
		margin-right: calc(3 * var(--layout-spacing-unit-small))


// folder
.portal__folder
	position: fixed
	top: var(--portal-header-height)
	right: 0
	bottom: 0
	left: 0

.portal__folder__overlay
	width: 100%
	height: 100%

.portal__folder__wrapper
	display: flex
	flex-direction: column
	align-items: center
	margin: auto
	width: 85%
	max-width: 720px
	height: 100%
	position: relative

	.ucsIconButton
		position: absolute
		top: calc(10 * var(--layout-spacing-unit))
		right: -32px

.box
	width: 720px
	height: @width
	border-radius: 10%
	margin: calc(10 * var(--layout-spacing-unit)) 0 calc(3 * var(--layout-spacing-unit))
	overflow: hidden
	position: relative

@css {
	.box {
		background: rgba(var(--color-grey0-rgb), 0.7);
	}
}

.carrousell
	display: flex
	position: relative
	transition: left 0.3s
	left: 0

.slide
	width: 720px // TODO duplicated
	height: @width
	display: grid
	grid-template-columns: repeat(3, 1fr)
	grid-template-rows: repeat(3, 1fr)
	align-items: center
	justify-items: center
	padding: calc(4 * var(--layout-spacing-unit))
	flex: 0 0 auto

.nav
	position: absolute
	bottom: 0
	width: 100%
	display: flex
	align-items: center
	justify-content: center

	.bubble
		cursor: pointer
		width: 16px
		height: 16px
		margin: 8px
		border-radius: 100%
		background: grey

		&--active
			background: white

// iframe tabs
.portal__iframeTabs
	display: flex
	flex: 1 1 auto
	margin-left: calc(5 * var(--layout-spacing-unit))

	.iframeTab
		--tabColor: transparent
		outline: 0
		cursor: pointer
		display: flex
		align-items: center
		min-width: calc(30 * var(--layout-spacing-unit))
		position: relative

		&:after
			content: ''
			display: block
			// height: var(--font-size-big)
			height: calc(3 * var(--layout-spacing-unit))
			width: 2px
			background: var(--color-grey8)
			position: relative
			right: -1px
			margin-left: var(--layout-spacing-unit-small)
			z-index: -2

	.iframeTabHover,
	.iframeTabFocused
		--tabColor: #272726
		z-index: 1
	.iframeTabSelected
		--tabColor: var(--color-grey8)
		z-index: 2

	$iframeTabColorTransitionTime = 250ms
	.iframeTab__background
		transition: background-color $iframeTabColorTransitionTime
		position: absolute
		top: 10px
		right: -1px
		bottom: 0
		left: -1px
		border-radius: 8px 8px 0 0
		background-color: var(--tabColor)
		z-index: -1

		&:before,
		&:after
			content: ''
			display: block
			position: absolute
			bottom: 0
			height: 8px
			width: 16px
			transition: box-shadow $iframeTabColorTransitionTime
		&:before
			left: -16px
			border-radius: 0 0 8px 0
		&:after
			right: -16px
			border-radius: 0 0 0 8px
		&:before
			box-shadow: 8px 0 0 0 var(--tabColor)
		&:after
			box-shadow: -8px 0 0 0 var(--tabColor)

	.iframeTab__logo
		width: calc(2 * var(--layout-spacing-unit))
		margin-right: calc(3 * var(--layout-spacing-unit-small))
		margin-left: calc(4 * var(--layout-spacing-unit-small))

	.iframeTab__title
		flex: 1 1 auto

.portal__mobileIframeTabs
	overflow: auto
	position: fixed
	top: var(--portal-header-height)
	right: 0
	bottom: 0
	left: 0
	display: flex
	flex-direction: column
	align-items: center
	flex: 1 1 auto
	padding-top: calc(5 * var(--layout-spacing-unit))

	.iframeTab
		flex: 0 0 auto
		outline: 0
		cursor: pointer
		display: flex
		align-items: center
		height: calc(7 * var(--layout-spacing-unit))
		width: 90%
		max-width: calc(50 * var(--layout-spacing-unit))
		border-radius: 16px
		background: var(--color-grey0)
		margin-bottom: calc(3 * var(--layout-spacing-unit))

	.iframeTab__background
		display: none

	.iframeTab__logo
		width: calc(3 * var(--layout-spacing-unit))
		margin-right: calc(3 * var(--layout-spacing-unit-small))
		margin-left: calc(3 * var(--layout-spacing-unit))

	.iframeTab__title
		flex: 1 1 auto

	.iframeTab__closeButton
		margin-left: calc(3 * var(--layout-spacing-unit-small))
		margin-right: calc(2 * var(--layout-spacing-unit))

.portal__mobileIframeTabsButton
	position: relative

	.portal__mobileIframeTabsButton__counter
		pointer-events: none
		display: block
		font-size: 12px
		position: absolute
		top: 15px
		left: 19px

	&.dijitChecked .portal__mobileIframeTabsButton__counter
		color: var(--color-primary)

// iframe tabs end


// iframes
.portal__iframes
	position: fixed
	top: var(--portal-header-height)
	border: 0px solid var(--color-grey8) // TODO var for selected tab color
	border-top-width: var(--portal-header-to-content-seperator-height)
	right: 0
	bottom: 0
	left: 0
	background-color: white
	// z-index: 27 // TODO

.portalIframe
	width: 100%
	height: 100%
	// z-index: 27
	display: flex
	align-items: center
	justify-content: center

.portalIframe__status
	position: absolute
	// z-index: 27

.portalIframe__iframe
	border: none
	// z-index: 27
	width: 100%
	height: 100%
// iframes end


// search
.portal__search
	width: 95%
	max-width: calc(40 * var(--layout-spacing-unit))
	position: fixed
	top: "calc(%s + %s)" % (var(--portal-header-height) var(--portal-header-to-content-seperator-height))
	transition: right 250ms
	right: -@width

	&--open
		right: 0

.portalSearchBox
	background-color: var(--color-grey0)
// search end


// background
.portal__background
	display: none
	position: fixed
	top: var(--portal-header-height)
	left: 0
	right: 0
	bottom: 0
// background end


// login iframe
.portal__loginIframeWrapper
	position: fixed
	top: var(--portal-header-height)
	left: 0
	right: 0
	bottom: 0
// login iframe end


// notifications
.ucsNotifications
	overflow: auto
	position: fixed
	top: var(--portal-header-height)
	bottom: 0
	right: 0
	width: 80%
	max-width: 360px
	border: 0px solid var(--color-grey8)
	border-top-width: var(--layout-spacing-unit-small)
	background-color: var(--color-grey0)
	transition: transform cubic-bezier(0.4, 0, 0.6, 1) 0.15s
	z-index: 30
	transform: translate3d(110%, 0, 0)
	padding: 0 calc(2 * var(--layout-spacing-unit))
	display: flex
	flex-direction: column

	&--open
		transform: translate3d(0, 0, 0)

.ucsNotifications__title
	margin: calc(2 * var(--layout-spacing-unit)) 0

$ucsNotificationBorderRadius = 12px
$ucsNotificationBgc = #121211 // TODO FIXME where is this color coming from
.ucsNotification
	background: $ucsNotificationBgc
	border-radius: $ucsNotificationBorderRadius
	padding: 16px
	font-size: var(--font-size-small)
	margin-bottom: 16px

.ucsNotification__header
	display: flex
	align-items: center
	margin-bottom: 8px

.ucsNotification__logoWrapper
	flex: 0 0 auto
	width: 16px
	height: 16px
	border-radius: 2px
	background: var(--color-grey25)
	margin-right: 8px

.ucsNotification__title
	flex: 1 1 auto

.ucsNotification__closeButton
	flex: 0 0 auto

.ucsNotificationPreview
	position: fixed
	top: calc(var(--portal-header-height) + 16px)
	right: var(--layout-spacing-unit)
	width: 90vw
	max-width: 300px
	opacity: 0
	transition: opacity 0ms

	.ucsNotification
		position: relative
		background: transparent
		margin: 0

	&--open
		opacity: 1

.ucsNotificationPreview__background--drained
	position: absolute
	top: 0
	left: 0
	bottom: 0
	right: 0
	overflow: hidden
	border-radius: $ucsNotificationBorderRadius
	background: var(--color-grey25)

.ucsNotificationPreview__background--full
	height: 100%
	width: 100%
	border-radius: $ucsNotificationBorderRadius 0 0 $ucsNotificationBorderRadius
	background: $ucsNotificationBgc
	transition: width 0ms linear

	&.drained
		width 0

.ucsNotificationPreview__triangle
	position: absolute
	top: -12px
	right: 72px
	width: 0
	height: 0
	border-left: 8px solid transparent
	border-right: 8px solid transparent
	border-bottom: 12px solid $ucsNotificationBgc
// notifications end


// edit mode
.portal__header__editMode
	display: flex
	align-items: center

.editMode
	.portal__iframeTabs,
	.portal__header__right,
	.portal__search,
	.portal__iframes,
	.portal__loginIframeWrapper,
	.portal__mobileIframeTabs,
	.ucsNotificationPreview,
	.ucsNotifications,
	.mobileMenuCloseOverlay,
	.mobileMenu
		display: none

body:not(.editMode)
	.portal__header__editMode,
	.portalProperties
		display: none


.portal__header__editMode__text
	margin-right: 16px

.portalProperties__title
	margin-top: calc(2 * var(--layout-spacing-unit))

.portalProperties
	overflow: auto
	position: fixed
	top: var(--portal-header-height)
	bottom: 0
	right: 0
	width: 80%
	max-width: 360px
	border: 0px solid var(--color-grey8)
	border-top-width: var(--layout-spacing-unit-small)
	background-color: var(--color-grey0)
	transition: transform cubic-bezier(0.4, 0, 0.6, 1) 0.15s
	z-index: 30
	transform: translate3d(110%, 0, 0)
	padding: 0 calc(2 * var(--layout-spacing-unit))
	display: flex
	flex-direction: column

	&--open
		transform: translate3d(0, 0, 0)
// edit mode end

