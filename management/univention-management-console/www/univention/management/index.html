<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Univention Management Console</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="/univention/js/dijit/themes/umc/umc.css" type="text/css"/>

		<script type="text/javascript">
			//<!--
			function getQuery(/*String*/ param, /*mixed*/ defaultVal) {
				// parse the URI query string
				var query = window.location.search.substring(1);
				var vars = query.split('&');
				for (var i = 0; i < vars.length; i++) {
					// parse the tuple
					var tuple = vars[i].split('=');

					// check whether we found the particular parameter we are interested in
					if (2 == tuple.length && param == tuple[0]) {
						return tuple[1];
					}
				}

				// otherwise return the specified default value
				return defaultVal;
			}

			function getCookie(/*String*/ param, /*mixed*/ defaultVal) {
				// find the given parameter in the cookie string
				var reg = new RegExp(param + '=([a-zA-Z_-]*)');
				var m = reg.exec(document.cookie);
				if (m && m[1]) {
					return m[1];
				}

				// in case the parameter does not exist, return the default value
				return defaultVal;
			}

			var _fillUsernameField = function(username) {
				require('dojo/dom').byId('umcLoginUsername').value = username;
				require('dojo/dom').byId('umcLoginPassword').focus();
				//fire change event manually for internet explorer
				require(['dojo/dom', 'dojo/has'], function(dom, has) {
					if (has('ie') < 10) {
						var event = document.createEvent("HTMLEvents");
						event.initEvent("change", true, false);
						dom.byId('umcLoginUsername').dispatchEvent(event);
					}
				});
			};
			var _showLoginTooltip = function(evt) {
				require(["dojo/on", "dojo/_base/event", "dijit/Tooltip",  "umc/i18n!umc/app"], function(on, dojoEvent, Tooltip, _) {
					var node = evt.target;
					var helpText = _('Please login with a valid username and password.') + ' ';
					if (getQuery('username') == 'root') {
						helpText += _('Use the %s user for the initial system configuration.', '<b><a href="javascript:void();" onclick="_fillUsernameField(\'root\')">root</a></b>');
					} else {
						helpText += _('The default username to manage the domain is %s.', '<b><a href="javascript:void();" onclick="_fillUsernameField(\'Administrator\')">Administrator</a></b>');
					}
					Tooltip.show(helpText, node);
					if (evt) {
						dojoEvent.stop(evt);
					}
					on.once(dojo.body(), 'click', function(evt) {
						Tooltip.hide(node);
						dojoEvent.stop(evt);
					});
				});
			};

			var locale = getQuery('lang') || getCookie('UMCLang');
			if (locale) {
				locale = locale.replace('_', '-');
			}
			var dojoConfig = {
				has: {
					'dojo-undef-api': true
				},
				isDebug: window.location.pathname.indexOf('/debug') != -1,
				baseUrl: '/univention/js/dojo',
				locale: locale,
				async: true,
				deps: [],
				packages: [
					{ name: 'umc-app', location: '/univention/management/js' }
				],
				map: {
					'*': {
						'umc/app': 'umc-app/app'
		//				'umc/modules': 'umc-app/modules'
					}
				},
				callback: function() {
					require(["dojo/parser", "umc/app", "umc/tools", "umc/app/LanguageSwitch", "umc/hook", "dojo/domReady!"], function(parser, app, tools) {
						// parse the DOM tree
						parser.parse();

						// set the version of the UMC frontend
						tools.status('version', '%VERSION%');

						// start the application when everything has been loaded
						app.start({
							username: getQuery('username'),
							password: getQuery('password'),
							module: getQuery('module'),
							flavor: getQuery('flavor'),
							overview: getQuery('overview', true)
						});
					});
				}
			};
			//-->
		</script>
		<script type="text/javascript" async src="/univention/js/dojo/dojo.js"></script>
	</head>
	<body class="umc umcOverviewShown">
		<!--[if lte IE 8]>
			<div class="warningWrapper">
				<div class="warningCenterer"></div>
				<div class="warning umc_ie">
					<div class="icon"></div>
					<div class="title">Browser upgrade required</div>
					<p>To use this service one of the following browsers is required:</p>
					<p>
						Internet Explorer (version 9 or higher),<br>
						Firefox ( >= 24 ),<br>
						Google Chrome ( >= 33 ),<br>
						Safari ( >= 7 ).
					</p>
				</div>
			</div>
		<![endif]-->
		<!--[if gte IE 9]><!-->
		<div id="umcLoginWrapper">
			<div id="umcFakeLoginLogo"></div>
			<div id="umcLoginHeaderRight">
				<div id="umcSingleSignOn" data-dojo-type="umc/app/SingleSignOn"></div>
				<div id="umcLanguageSwitch" data-dojo-type="umc/app/LanguageSwitch"></div>
			</div>
			<div id="umcLoginCenterer"></div>
			<div id="umcLoginDialog" class="umcLoginLoading dijitDialog dojoxDialog umcLoginDialog">
				<div id="umcLoginLogo" class="umcLoginLogo">
					<img id="umcLoginLogo" src="/univention/js/dijit/themes/umc/images/login_logo.png"/>
				</div>
				<form id="umcLoginForm" name="umcLoginForm" action="blank.html" method="post" class="umcLoginForm" autocomplete="on">
					<label for="umcLoginUsername">
						<input placeholder="Username" id="umcLoginUsername" name="username" type="text" autocomplete="on"/>
						<a href="javascript:void(0);" onclick="_showLoginTooltip(event);" tabindex="-1">
							<span class="dijitReset dijitInline dijitIcon umcHelpIcon"></span>
						</a>
					</label>
					<label for="umcLoginPassword">
						<input placeholder="Password" id="umcLoginPassword" name="password" type="password" autocomplete="on"/>
						<input id="umcLoginSubmit" type="submit" name="submit" value="Login"/>
					</label>
				</form>
				<form id="umcNewPasswordForm" name="umcLoginForm" action="blank.html" method="post" class="umcLoginForm" style="display: none;" autocomplete="off">
					<label for="umcLoginNewPassword">
						<input placeholder="New Password" id="umcLoginNewPassword" name="new_password" type="password" autocomplete="off"/>
					</label>
					<label for="umcLoginNewPasswordRetype">
						<input placeholder="New Password (retype)" id="umcLoginNewPasswordRetype" type="password" autocomplete="off"/>
						<input type="submit" name="submit" value="Login"/>
					</label>
				</form>
				<form id="umcCustomPromptForm" name="umcCustomPromptForm" action="blank.html" method="post" class="umcLoginForm" style="display: none;" autocomplete="off">
					<label for="umcLoginCustomPrompt">
						<input placeholder="One time password" id="umcLoginCustomPrompt" type="password" autocomplete="off"/>
						<input type="submit" name="submit" value="Login"/>
					</label>
				</form>
				<img src="/univention/js/dijit/themes/umc/images/login_bg.gif" height="0" width="0">
			</div>
		</div>
		<!--<![endif]-->
		<div id="umcTopContainer" class="umcTopContainer"></div>
		<iframe id="umcLoginIframe" src="login.html"></iframe>
		<noscript>
			<div class="warningWrapper">
				<div class="warningCenterer"></div>
				<div class="warning" id="no-js">
					<div class="icon"></div>
					<div class="title">JavaScript required</div>
					<p>A browser with JavaScript enabled is required in order to use this service.</p>
					<p>When using Internet Explorer, please check your security settings and add this address to your trusted sites.</p>
				</div>
			</div>
		</noscript>
	</body>
</html>
