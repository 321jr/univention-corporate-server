#!/bin/sh -e
#
# Univention Directory Notifier
#  preinst
#
# Copyright (C) 2004, 2005, 2006, 2007 Univention GmbH
#
# http://www.univention.de/
#
# All rights reserved.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2 as
# published by the Free Software Foundation.
#
# Binary versions of this file provided by Univention to you as
# well as other copyrighted, protected or trademarked materials like
# Logos, graphics, fonts, specific documentations and configurations,
# cryptographic keys etc. are subject to a license agreement between
# you and Univention.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA

# dpkg doesn't handle moving configuration files correctly
if [ ! -z "$2" ]; then
	origsum=80059d0b205c7c9333eb89fc37c17307
	file=/etc/init.d/univention-directory-notifier
	
	if ! [ -e "$file" ]; then
		continue
	fi
	
	nowsum=`md5sum "$file" | cut -d ' ' -f 1`
	if [ "$nowsum" = "$origsum" ]; then
		rm -f "$file"
	fi
	
fi

# The following is for transition purposes only and can be removed once 2.1 is
# released

if [ -e /etc/init.d/univention-ldap-notifier ]; then
    /etc/init.d/univention-ldap-notifier stop
fi

if [ -e /etc/init.d/univention-directory-notifier ]; then
    /etc/init.d/univention-directory-notifier stop
fi

if [ -e /etc/runit/univention-ldap-notifier -a ! -h /etc/runit/univention-ldap-notifier ]; then
    mv /etc/runit/univention-ldap-notifier /etc/runit/univention-directory-notifier
fi


#DEBHELPER#

