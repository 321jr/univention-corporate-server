# Warning: This file is auto-generated and might be overwritten by
#          univention-baseconfig.
#          Please edit the following file instead:
# Warnung: Diese Datei wurde automatisch generiert und kann durch
#          univention-baseconfig überschrieben werden.
#          Bitte bearbeiten Sie an Stelle dessen die folgende Datei:
#
# 	/etc/univention/templates/files/etc/ntp.conf
#

# /etc/ntp.conf, configuration for ntpd

# ntpd will use syslog() if logfile is not defined
#logfile /var/log/ntpd

driftfile /var/lib/ntp/ntp.drift
statsdir /var/log/ntpstats/

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable


@!@
if not (baseConfig.has_key('timeserver') and baseConfig['timeserver'] == 'local'):
	if baseConfig.has_key('server/role') and baseConfig['server/role'] != "domaincontroller_master":
		if baseConfig.has_key('ldap/master') and baseConfig['ldap/master']:
			print 'server %s' % baseConfig['ldap/master']
		if baseConfig.has_key('ldap/backup') and baseConfig['ldap/backup']:
			backup=baseConfig['ldap/backup'].split(' ')
			fqdn=baseConfig['hostname']+'.'+baseConfig['domainname']
			for i in range(0,len(backup)):
				if backup[i] != fqdn and backup[i] != "":
					print 'server %s' % backup[i]
	if baseConfig.has_key('timeserver') and baseConfig['timeserver']:
		print 'server %s' % baseConfig['timeserver']
	if baseConfig.has_key('timeserver2') and baseConfig['timeserver2']:
		print 'server %s' % baseConfig['timeserver2']
	if baseConfig.has_key('timeserver3') and baseConfig['timeserver3']:
		print 'server %s' % baseConfig['timeserver3']
@!@

### Synchronize with local server, if no other
### could be reached

server 127.127.1.0
@!@
if baseConfig.has_key('server/role') and baseConfig['server/role'] == 'domaincontroller_master':
	if baseConfig.has_key('timeserver') and baseConfig['timeserver'] == 'local':
		print 'fudge 127.127.1.0 stratum 1'
	else:
		print 'fudge 127.127.1.0 stratum 10'
else:
	print 'fudge 127.127.1.0 stratum 15'
@!@

