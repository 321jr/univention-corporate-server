#!/bin/sh

if grep -iq '\<noudev\>' /proc/cmdline; then
	echo "udev disabled"
else
	# sysfs
	if [ ! -d /sys ]; then
        	mkdir /sys
	fi
	mount -t sysfs none /sys

	# move dev 
	mv /dev /dev.old
	mkdir /dev


	# udev
	echo > /sys/kernel/uevent_helper
	mkdir -p /dev/.udev/db/
	udevd --daemon 1>/dev/null 2>/dev/null
	mkdir -p /dev/.udev/queue/ /dev/.udev/rules.d/
	udevadm trigger 1>/dev/null 2>/dev/null
	udevadm settle 1>/dev/null 2>/dev/null || true
fi
