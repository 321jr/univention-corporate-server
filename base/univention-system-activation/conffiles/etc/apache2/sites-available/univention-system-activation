@%@UCRWARNING=# @%@

# from disabled default site
MaxClients @%@apache2/maxclients@%@

ServerAdmin webmaster@@%@hostname@%@.@%@domainname@%@
ServerSignature Off
ServerTokens Prod

CustomLog /var/log/univention/system-activation.log combined
ErrorLog /var/log/univention/system-activation-error.log

# Possible values include: debug, info, notice, warn, error, crit,
# alert, emerg.
LogLevel @%@apache2/loglevel@%@

DocumentRoot /usr/share/univention-system-activation/www
<Directory /usr/share/univention-system-activation/www>
    Options Indexes FollowSymLinks MultiViews
    AllowOverride AuthConfig Limit FileInfo
    Order allow,deny
    allow from all
	<FilesMatch "(entries|languages).json">
		# prevent to cache this file in IE<10
		Header set Cache-Control "max-age=0, must-revalidate, no-cache, no-store"
	</FilesMatch>
</Directory>

WSGIScriptAlias /license /usr/share/pyshared/univention/system_activation/wsgi.py

Alias /ucs-overview/ /var/www/ucs-overview/
<Directory /var/www/ucs-overview>
    Order allow,deny
    allow from all
</Directory>

# allow umcp commands ... taken from UMC apache site config file
ProxyPreserveHost on

@!@
port = int(configRegistry.get('umc/http/port', 8090))
interface = configRegistry.get('umc/http/interface', '127.0.0.1')

print 'ProxyPass /umcp/ http://%s:%s/ retry=0' % (interface, port)
print 'ProxyPassReverse /umcp/ http://%s:%s/' % (interface, port)
print 'ProxyTimeout %s' % int(configRegistry.get('umc/http/session/timeout', '300'))
@!@

<LocationMatch "^/umcp/">
	RequestHeader set X-UMC-HTTPS %{HTTPS}s
	ErrorDocument 503 "{\"status\": 503, \"message\": \"The Univention Management Console Web Server could not be reached. Please restart it or try later.\"}"
	# fix for bug in cherrypy returnin 408/409 errors out of the blue:
	#   http://cherrypy.org/ticket/853
	SetEnv proxy-nokeepalive 1
</LocationMatch>
