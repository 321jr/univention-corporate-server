#!/usr/bin/python
#
# Univention NTP Configuration
#  mapping between timezone and ntp pool
#
# Copyright 2013-2014 Univention GmbH
#
# http://www.univention.de/
#
# All rights reserved.
#
# The source code of this program is made available
# under the terms of the GNU Affero General Public License version 3
# (GNU AGPL V3) as published by the Free Software Foundation.
#
# Binary versions of this program provided by Univention to you as
# well as other copyrighted, protected or trademarked materials like
# Logos, graphics, fonts, specific documentations and configurations,
# cryptographic keys etc. are subject to a license agreement between
# you and Univention and not subject to the GNU AGPL V3.
#
# In the case you use this program under the terms of the GNU AGPL V3,
# the program is provided in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public
# License with the Debian GNU/Linux or Univention distribution in file
# /usr/share/common-licenses/AGPL-3; if not, see
# <http://www.gnu.org/licenses/>.

import os

time_zone_to_ntp_pool_area = {
	'Africa/Johannesburg': 'za',
	'Africa/Cairo': 'eg',
	'America/Adak': 'us',
	'America/Anchorage': 'us',
	'America/Anguilla': 'north-america',
	'America/Antigua': 'north-america',
	'America/Araguaina': 'br',
	'America/Aruba': 'south-america',
	'America/Asuncion': 'south-america',
	'America/Atikokan': 'ca',
	'America/Atka': 'us',
	'America/Bahia': 'br',
	'America/Bahia_Banderas': 'mx',
	'America/Barbados': 'south-america',
	'America/Belem': 'br',
	'America/Belize': 'south-america',
	'America/Blanc-Sablon': 'ca',
	'America/Boa_Vista': 'br',
	'America/Bogota': 'south-america',
	'America/Boise': 'us',
	'America/Buenos_Aires': 'ar',
	'America/Cambridge_Bay': 'ca',
	'America/Campo_Grande': 'br',
	'America/Cancun': 'mx',
	'America/Caracas': 've',
	'America/Catamarca': 'ar',
	'America/Cayenne': 'south-america',
	'America/Cayman': 'north-america',
	'America/Chicago': 'us',
	'America/Chihuahua': 'mx',
	'America/Coral_Harbour': 'ca',
	'America/Cordoba': 'ar',
	'America/Costa_Rica': 'north-america',
	'America/Creston': 'ca',
	'America/Cuiaba': 'br',
	'America/Curacao': 'south-america',
	'America/Danmarkshavn': 'north-america',
	'America/Dawson': 'ca',
	'America/Dawson_Creek': 'ca',
	'America/Denver': 'us',
	'America/Detroit': 'us',
	'America/Dominica': 'north-america',
	'America/Edmonton': 'ca',
	'America/Eirunepe': 'br',
	'America/El_Salvador': 'north-america',
	'America/Ensenada': 'mx',
	'America/Fortaleza': 'br',
	'America/Fort_Wayne': 'us',
	'America/Glace_Bay': 'ca',
	'America/Godthab': 'north-america',
	'America/Goose_Bay': 'ca',
	'America/Grand_Turk': 'north-america',
	'America/Grenada': 'south-america',
	'America/Guadeloupe': 'north-america',
	'America/Guatemala': 'north-america',
	'America/Guayaquil': 'south-america',
	'America/Guyana': 'south-america',
	'America/Halifax': 'ca',
	'America/Havana': 'north-america',
	'America/Hermosillo': 'mx',
	'America/Inuvik': 'ca',
	'America/Iqaluit': 'ca',
	'America/Jamaica': 'north-america',
	'America/Jujuy': 'ar',
	'America/Juneau': 'us',
	'America/Knox_IN': 'us',
	'America/La_Paz': 'south-america',
	'America/Lima': 'south-america',
	'America/Los_Angeles': 'us',
	'America/Louisville': 'us',
	'America/Maceio': 'br',
	'America/Managua': 'north-america',
	'America/Manaus': 'br',
	'America/Marigot': 'south-america',
	'America/Martinique': 'south-america',
	'America/Matamoros': 'mx',
	'America/Mazatlan': 'mx',
	'America/Mendoza': 'ar',
	'America/Menominee': 'us',
	'America/Merida': 'mx',
	'America/Metlakatla': 'us',
	'America/Mexico_City': 'mx',
	'America/Miquelon': 'north-america',
	'America/Moncton': 'ca',
	'America/Monterrey': 'mx',
	'America/Montevideo': 'south-america',
	'America/Montreal': 'ca',
	'America/Montserrat': 'south-america',
	'America/Nassau': 'north-america',
	'America/New_York': 'us',
	'America/Nipigon': 'ca',
	'America/Nome': 'us',
	'America/Noronha': 'br',
	'America/Ojinaga': 'mx',
	'America/Panama': 'north-america',
	'America/Pangnirtung': 'ca',
	'America/Paramaribo': 'south-america',
	'America/Phoenix': 'us',
	'America/Port-au-Prince': 'north-america',
	'America/Porto_Acre': 'br',
	'America/Port_of_Spain': 'north-america',
	'America/Porto_Velho': 'br',
	'America/Puerto_Rico': 'north-america',
	'America/Rainy_River': 'ca',
	'America/Rankin_Inlet': 'ca',
	'America/Recife': 'br',
	'America/Regina': 'ca',
	'America/Resolute': 'ca',
	'America/Rio_Branco': 'br',
	'America/Rosario': 'ar',
	'America/Santa_Isabel': 'mx',
	'America/Santarem': 'br',
	'America/Santiago': 'cl',
	'America/Santo_Domingo': 'north-america',
	'America/Sao_Paulo': 'br',
	'America/Scoresbysund': 'north-america',
	'America/Shiprock': 'us',
	'America/Sitka': 'us',
	'America/St_Barthelemy': 'south-america',
	'America/St_Johns': 'ca',
	'America/St_Kitts': 'south-america',
	'America/St_Lucia': 'south-america',
	'America/St_Thomas': 'north-america',
	'America/St_Vincent': 'south-america',
	'America/Swift_Current': 'ca',
	'America/Tegucigalpa': 'north-america',
	'America/Thule': 'north-america',
	'America/Thunder_Bay': 'ca',
	'America/Tijuana': 'mx',
	'America/Toronto': 'ca',
	'America/Tortola': 'north-america',
	'America/Vancouver': 'ca',
	'America/Virgin': 'us',
	'America/Whitehorse': 'ca',
	'America/Winnipeg': 'ca',
	'America/Yakutat': 'us',
	'America/Yellowknife': 'ca',
	'Asia/Almaty': 'kz',
	'Asia/Anadyr': 'ru',
	'Asia/Aqtau': 'kz',
	'Asia/Aqtobe': 'kz',
	'Asia/Baghdad': 'iq',
	'Asia/Bahrain': 'sa',
	'Asia/Bangkok': 'th',
	'Asia/Bishkek': 'kg',
	'Asia/Brunei': 'my',
	'Asia/Calcutta': 'in',
	'Asia/Chongqing': 'cn',
	'Asia/Chungking': 'cn',
	'Asia/Colombo': 'lk',
	'Asia/Dacca': 'bd',
	'Asia/Dhaka': 'bd',
	'Asia/Harbin': 'cn',
	'Asia/Ho_Chi_Minh': 'vn',
	'Asia/Hong_Kong': 'hk',
	'Asia/Irkutsk': 'ru',
	'Asia/Istanbul': 'tr',
	'Asia/Jakarta': 'id',
	'Asia/Jayapura': 'id',
	'Asia/Jerusalem': 'il',
	'Asia/Kamchatka': 'ru',
	'Asia/Karachi': 'pk',
	'Asia/Kashgar': 'cn',
	'Asia/Kolkata': 'in',
	'Asia/Krasnoyarsk': 'ru',
	'Asia/Kuala_Lumpur': 'my',
	'Asia/Kuching': 'my',
	'Asia/Macao': 'cn',
	'Asia/Macau': 'cn',
	'Asia/Magadan': 'ru',
	'Asia/Makassar': 'id',
	'Asia/Manila': 'ph',
	'Asia/Muscat': 'om',
	'Asia/Novokuznetsk': 'ru',
	'Asia/Novosibirsk': 'ru',
	'Asia/Omsk': 'ru',
	'Asia/Oral': 'kz',
	'Asia/Phnom_Penh': 'kh',
	'Asia/Pontianak': 'id',
	'Asia/Qyzylorda': 'kz',
	'Asia/Riyadh': 'sa',
	'Asia/Saigon': 'vn',
	'Asia/Sakhalin': 'ru',
	'Asia/Samarkand': 'uz',
	'Asia/Seoul': 'kr',
	'Asia/Shanghai': 'cn',
	'Asia/Singapore': 'sg',
	'Asia/Taipei': 'tw',
	'Asia/Tashkent': 'uz',
	'Asia/Tehran': 'ir',
	'Asia/Tel_Aviv': 'il',
	'Asia/Tokyo': 'jp',
	'Asia/Ujung_Pandang': 'id',
	'Asia/Urumqi': 'cn',
	'Asia/Vladivostok': 'ru',
	'Asia/Yakutsk': 'ru',
	'Asia/Yekaterinburg': 'ru',
	'Atlantic/Azores': 'pt',
	'Atlantic/Bermuda': 'uk',
	'Atlantic/Canary': 'es',
	'Atlantic/Madeira': 'pt',
	'Atlantic/Reykjavik': 'is',
	'Egypt': 'eg',
	'Eire': 'ie',
	'Europe/Amsterdam': 'nl',
	'Europe/Athens': 'gr',
	'Europe/Belfast': 'uk',
	'Europe/Belgrade': 'rs',
	'Europe/Berlin': 'de',
	'Europe/Bratislava': 'sk',
	'Europe/Brussels': 'be',
	'Europe/Bucharest': 'ro',
	'Europe/Budapest': 'hu',
	'Europe/Chisinau': 'md',
	'Europe/Copenhagen': 'dk',
	'Europe/Dublin': 'ie',
	'Europe/Gibraltar': 'gi',
	'Europe/Guernsey': 'uk',
	'Europe/Helsinki': 'fi',
	'Europe/Isle_of_Man': 'uk',
	'Europe/Istanbul': 'tr',
	'Europe/Jersey': 'uk',
	'Europe/Kaliningrad': 'ru',
	'Europe/Kiev': 'ua',
	'Europe/Lisbon': 'pt',
	'Europe/Ljubljana': 'si',
	'Europe/London': 'uk',
	'Europe/Luxembourg': 'lu',
	'Europe/Madrid': 'es',
	'Europe/Mariehamn': 'se',
	'Europe/Minsk': 'by',
	'Europe/Moscow': 'ru',
	'Europe/Nicosia': 'it',
	'Europe/Oslo': 'no',
	'Europe/Paris': 'fr',
	'Europe/Podgorica': 'me',
	'Europe/Prague': 'cz',
	'Europe/Riga': 'lt',
	'Europe/Rome': 'it',
	'Europe/Samara': 'ru',
	'Europe/Sarajevo': 'ba',
	'Europe/Simferopol': 'ua',
	'Europe/Skopje': 'mk',
	'Europe/Sofia': 'bg',
	'Europe/Stockholm': 'se',
	'Europe/Tallinn': 'ee',
	'Europe/Tirane': 'al',
	'Europe/Tiraspol': 'md',
	'Europe/Uzhgorod': 'ua',
	'Europe/Vaduz': 'li',
	'Europe/Vatican': 'it',
	'Europe/Vienna': 'at',
	'Europe/Vilnius': 'lt',
	'Europe/Volgograd': 'ru',
	'Europe/Warsaw': 'pl',
	'Europe/Zagreb': 'hr',
	'Europe/Zaporozhye': 'ua',
	'Europe/Zurich': 'ch',
	'GB': 'uk',
	'Greenwich': 'uk',
	'Hongkong': 'hk',
	'Iceland': 'is',
	'Indian/Antananarivo': 'mg',
	'Indian/Christmas': 'au',
	'Indian/Cocos': 'au',
	'Indian/Maldives': 'mv',
	'Iran': 'ir',
	'Israel': 'il',
	'Jamaica': 'il',
	'Japan': 'jp',
	'Pacific/Auckland': 'au',
	'Pacific/Chatham': 'nz',
	'Pacific/Easter': 'cl',
	'Pacific/Efate': 'vu',
	'Pacific/Guam': 'gu',
	'Pacific/Honolulu': 'us',
	'Pacific/Johnston': 'us',
	'Pacific/Noumea': 'nc',
	'Pacific/Wake': 'us',
	'Poland': 'pl',
	'Portugal': 'pt',
	'Singapore': 'sg',
	'Turkey': 'tr',
}

timezone_prefix_to_ntp_pool_area = {
	'Africa/': 'africa',
	'America/Argentina/': 'ar',
	'America/Indiana/': 'us',
	'America/Kentucky/': 'us',
	'America/North_Dakota/': 'us',
	'Asia/': 'asia',
	'Australia/': 'au',
	'Brazil/': 'br',
	'Canada/': 'ca',
	'Chile/': 'cl',
	'Europe/': 'europe',
	'Mexico/': 'mx',
	'Pacific/': 'oceania',
	'US/': 'us',
}

if __name__ == '__main__':
	tz=None
	tzfile='/etc/timezone'

	if os.path.exists(tzfile):
		f = open(tzfile, 'r')
		tz = f.readline().strip()
		f.close()

	ntp_pool_area = time_zone_to_ntp_pool_area.get(tz)
	if tz:
		if not ntp_pool_area:
			for prefix in timezone_prefix_to_ntp_pool_area:
				if tz.startswith(prefix):
					ntp_pool_area = timezone_prefix_to_ntp_pool_area[prefix]
					break

	if ntp_pool_area:
		ntp_pool = '%s.pool.ntp.org' % ntp_pool_area
	else:
		ntp_pool = 'pool.ntp.org'

	print ntp_pool
