<?xml version="1.0" encoding="UTF-8"?>
<umc version="2.0">
	<!--
@%@UCRWARNING=# @%@
	-->
	<module id="appliance" priority="50" version="1.0">
		<name>Appliance</name>
		<description>Inserts first steps</description>
		<keywords></keywords>
		<categories>
		</categories>
		<command name="appliance/get" function="get" />
	</module>

@!@
import cgi
from univention.app_appliance import AppManager

appId = configRegistry.get('umc/web/appliance/id', '')
app = AppManager.find(appId)

link_appcenter_detailspage = '''
	<module id="apps">
		<flavor icon="{icon}" priority="-100" id="{id}">
			<name>{name}</name>
			<description>{description}</description>
			<categories>
				<category name="_appliance_"/>
			</categories>
		</flavor>
	</module>'''

link_web_interface = '''
	<link priority="50" id="link-{id}-web-interface">
		<url>{web_interface}</url>
		<name>{name} Login</name>
		<description>Link to the {name} webinterface</description>
		<categories>
			<category name="_appliance_" />
		</categories>
	</link>'''

link_generic = '''
	<link priority="50" id="link-{uuid}">
		<url>{url}</url>
		<name>{name}</name>
		<description>{desc}</description>
		<categories>
			<category name="_appliance_" />
		</categories>
	</link>'''

module_with_flavor = '''
	<module id="{moduleId}">
		<flavor id="{flavor}">
			<categories>
				<category name="_appliance_" />
			</categories>
		</flavor>
	</module>'''

module_without_flavor = '''
	<module id="{moduleId}">
		<categories>
			<category name="_appliance_" />
		</categories>
	</module>'''

if app:
	print link_appcenter_detailspage.format(
		id=cgi.escape(app.id or ''),
		name=cgi.escape(app.name or ''),
		version=cgi.escape(app.version or ''),
		description=cgi.escape(app.description or ''),
		icon=cgi.escape(app.logo_name or ''),
	)
	
	if app.web_interface:
		print link_web_interface.format(
			id=cgi.escape(app.id or ''),
			web_interface=cgi.escape(app.web_interface),
			name=cgi.escape(app.name or '')
		)

	if app.appliance_category_modules:
		for module in app.appliance_category_modules:
			module = module.split(':')
			if len(module) == 2:
				moduleId, flavor = module
				print module_with_flavor.format(
					moduleId=cgi.escape(moduleId),
					flavor=cgi.escape(flavor)
				)
			else:
				print module_without_flavor.format(
					moduleId=cgi.escape(module[0])
				)
@!@
</umc>
