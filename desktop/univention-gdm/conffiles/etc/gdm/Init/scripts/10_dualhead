#!/bin/bash
@%@BCWARNING=#@%@

eval "$(univention-config-registry shell)"

max ()
{
	if [ "$1" -gt "$2" ]; then
		echo -n "$1"
	else
		echo -n "$2"
	fi
}

if [ -n "$xorg_resolution_secondary" ]; then
	x_prim="${xorg_resolution%x*}"
	y_prim="${xorg_resolution##*x}"
	x_sec="${xorg_resolution_secondary%x*}"
	y_sec="${xorg_resolution_secondary##*x}"

	if [ -n "$xorg_display_relative_position" ]; then
		if [ "$xorg_display_relative_position" = "right" -o "$xorg_display_relative_position" = "left" ]; then
			new_value="$((x_prim+x_sec)) $(max $y_prim $y_sec)"
		elif [ "$xorg_display_relative_position" = "above" -o "$xorg_display_relative_position" = "belove" ]; then
			new_value="$(max $x_prim $x_sec) $(y_prim+y_sec)"
		fi
	fi
	if [ -n "$new_value" ] && [ "$new_value" != "$xorg_virtual_size" ]; then
		if [ -z "$xorg_ignore_display_virtual" ]; then
			univention-config-registry set xorg/display/virtual="$new_value"
		fi
	fi

	# try to set device names 
	xrandr_output=$(LC_ALL=C xrandr | sed -n 's| connected.*||p')
	prim_name="${xrandr_output%
*}"
	sec_name="${xrandr_output##*
}"
	if [ -z "$xorg_display_primary" -a -z "$xorg_display_secondary" ]; then
		univention-config-registry set xorg/display/primary="$prim_name" xorg/display/secondary="$sec_name"
	elif [ -z "$xorg_display_primary" ]; then
		univention-config-registry set xorg/display/primary="$prim_name"
	elif [ -z "$xorg_display_secondary" ]; then
		univention-config-registry set xorg/display/secondary="$sec_name"
	fi

fi

exit 0
